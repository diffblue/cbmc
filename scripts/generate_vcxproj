dest=../src

if ! [ -e $dest/Makefile ] ; then echo Makefile not found ; exit 1; fi

echo Generating Visual Studio Project files in $dest

function doit {
  echo Generating $dest/$1.vcxproj

  cat vcxproj.1 > $dest/$1.vcxproj

  # this collects all the files needed
  echo "  <ItemGroup>" >> $dest/$1.vcxproj
  for dir in $dirs ; do
    sources="`(cd $dest/$dir; make sources)`"
    for s in $sources ; do
      echo "    <ClCompile Include=\"${dir}\\${s}\"/>" >> $dest/$1.vcxproj
    done
  done
  echo "  </ItemGroup>" >> $dest/$1.vcxproj

  cat vcxproj.2 >> $dest/$1.vcxproj
}

dirs="ansi-c cpp java_bytecode solvers goto-symex analyses pointer-analysis goto-programs linking cbmc"
doit cbmc

dirs="ansi-c cpp java_bytecode solvers goto-symex analyses pointer-analysis goto-programs linking goto-cc"
doit goto-cc

dirs="ansi-c cpp java_bytecode solvers goto-symex analyses pointer-analysis goto-programs linking goto-instrument"
doit goto-instrument
