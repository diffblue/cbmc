<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cbmc_tutorial">CBMC Developer Tutorial</a><ul><li class="level2"><a href="#autotoc_md196">Initial setup</a></li>
<li class="level2"><a href="#autotoc_md197">Whirlwind tour of the tools</a><ul><li class="level3"><a href="#autotoc_md198">Compiling with &lt;tt&gt;goto-cc&lt;/tt&gt;</a></li>
<li class="level3"><a href="#autotoc_md199">Viewing goto-programs</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md200">Learning about goto-programs</a><ul><li class="level3"><a href="#autotoc_md201">First steps with &lt;tt&gt;goto-instrument&lt;/tt&gt;</a></li>
<li class="level3"><a href="#autotoc_md202">Goto-program basics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="cbmc_tutorial"></a>
CBMC Developer Tutorial</h1>
<dl class="section author"><dt>Author</dt><dd>Kareem Khazem</dd></dl>
<p>This is an introduction to hacking on the <code>cprover</code> codebase. It is not intended as a user guide to <code>CBMC</code> or related tools. It is structured as a series of programming exercises that aim to acclimatise the reader to the basic data structures and workflow needed for contributing to <code>CBMC</code>.</p>
<h2><a class="anchor" id="autotoc_md196"></a>
Initial setup</h2>
<p>Clone the <a href="https://github.com/diffblue/cbmc/">CBMC repository</a> and build it. The build instructions are written in a file called COMPILING.md in the top level of the repository. I recommend that you build using CMake&mdash;this will place all of the CBMC tools in a single directory, which you can add to your <code>$PATH</code>. For example, if you built the codebase with the following two commands at the top level of the repository: </p><pre class="fragment">cmake -DCMAKE_BUILD_TYPE=Debug                  \
      -DCMAKE_CXX_COMPILER=/usr/bin/clang++     \
      -DCMAKE_C_COMPILER=/usr/bin/clang         \
      -B build -S .
cmake --build build
</pre><p> then all the CBMC binaries will be built into <code>build/bin</code>, and you can run the following commands to make CBMC invokable from your terminal. </p><pre class="fragment"># Assuming you cloned CBMC into ~/code
export PATH=~/code/cbmc/build/bin:$PATH
# Add to your shell's startup configuration file so that you don't have to run that command every time.
echo 'export PATH=~/code/cbmc/build/bin:$PATH' &gt;&gt; .bashrc
</pre><p> If you are using Make instead of CMake, the built binaries will be scattered throughout the source tree. This tutorial uses the binaries <code>src/cbmc/cbmc</code>, <code>src/goto-instrument/goto-instrument</code>, and <code>src/goto-cc/goto-gcc</code>, so you will need to add each of those directories to your <code>$PATH</code>, or symlink to those binaries from a directory that is already in your <code>$PATH</code>.</p>
<p>Ensure that <a href="http://www.graphviz.org/">graphviz</a> is installed on your system (in particular, you should be able to run a program called <code>dot</code>). Install <a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> and generate doxygen documentation: </p><pre class="fragment"># In the src directory
doxygen doxyfile
# View the documentation in a web browser
firefox ~/code/cbmc/doc/html/index.html
</pre><p> If you've never used doxygen documentation before, get familiar with the layout. Open the generated HTML page in a web browser; search for the class <code><a class="el" href="classgoto__programt.html" title="A generic container class for the GOTO intermediate representation of one function.">goto_programt</a></code> in the search bar, and jump to the documentation for that class; and read through the copious documentation.</p>
<h2><a class="anchor" id="autotoc_md197"></a>
Whirlwind tour of the tools</h2>
<p>CBMC's code is located under the <code>src</code> directory. Even if you plan to contribute only to CBMC, it is important to be familiar with several other of cprover's auxiliary tools.</p>
<h3><a class="anchor" id="autotoc_md198"></a>
Compiling with &lt;tt&gt;goto-cc&lt;/tt&gt;</h3>
<p>If you built using CMake on Unix, you should be able to run the <code>goto-gcc</code> command. Find or write a moderately-interesting C program; we'll call it <code>main.c</code>. Run the following commands: </p><pre class="fragment">goto-gcc -o main.gb main.c
cc -o main.exe main.c
</pre><p> Invoke <code>./main.gb</code> and <code>./main.exe</code> and observe that they run identically. The version that was compiled with <code>goto-gcc</code> is larger, though: </p><pre class="fragment">du -hs *.{goto,exe}
</pre><p> Programs compiled with <code>goto-gcc</code> are mostly identical to their <code>clang</code>- or <code>gcc</code>-compiled counterparts, but contain additional object code in cprover's intermediate representation. The intermediate representation is (informally) called a <em>goto-program</em>.</p>
<h3><a class="anchor" id="autotoc_md199"></a>
Viewing goto-programs</h3>
<p><code>goto-instrument</code> is a Swiss army knife for viewing goto-programs and performing single program analyses on them. Run the following command: </p><pre class="fragment">goto-instrument --show-goto-functions main.gb
</pre><p> Many of the instructions in the goto-program intermediate representation are similar to their C counterparts. <code>if</code> and <code>goto</code> statements replace structured programming constructs.</p>
<p>Find or write a small C program (2 or 3 functions, each containing a few varied statements). Compile it using <code>goto-gcc</code> as above into an object file called <code>main</code>. You can write the diagram to a file and then view it: </p><pre class="fragment">goto-instrument --dot main.gb | tail -n +2 | dot -Tpng &gt; main.png
open main.png
</pre><p> (the invocation of <code>tail</code> is used to filter out the first line of <code>goto-instrument</code> output. If <code>goto-instrument</code> writes more or less debug output by the time you read this, read the output of <code>goto-instrument --dot main</code> and change the invocation of <code>tail</code> accordingly.)</p>
<p>There are a few other views of goto-programs. Run <code>goto-instrument -h</code> and try the various switches under the "Diagnosis" section.</p>
<h2><a class="anchor" id="autotoc_md200"></a>
Learning about goto-programs</h2>
<p>In this section, you will learn about the basic goto-program data structures. Reading from and manipulating these data structures form the core of writing an analysis for CBMC.</p>
<h3><a class="anchor" id="autotoc_md201"></a>
First steps with &lt;tt&gt;goto-instrument&lt;/tt&gt;</h3>
<div class="memdoc"> <b>Task:</b> Write a simple C program with a few functions, each containing a few statements. Compile the program with <code>goto-gcc</code> into a binary called <code>main</code>. </div><p>The entry point of <code>goto-instrument</code> is in <code><a class="el" href="goto__instrument__main_8cpp.html" title="Main Module.">goto_instrument_main.cpp</a></code>. Follow the control flow into <code><a class="el" href="classgoto__instrument__parse__optionst.html#af8821207915bba43813f040f8266aeba" title="invoke main modules">goto_instrument_parse_optionst::doit()</a></code>, located in <code><a class="el" href="goto__instrument__parse__options_8cpp.html" title="Main Module.">goto_instrument_parse_options.cpp</a></code>. At some point in that function, there will be a long sequence of <code>if</code> statements.</p>
<div class="memdoc"> <b>Task:</b> Add a <code>--greet</code> switch to <code>goto-instrument</code>, taking an optional argument, with the following behaviour: </div> <pre class="fragment">$ goto-instrument --greet main.gb
hello, world!
$ goto-instrument --greet Leperina main
hello, Leperina!
</pre><p> You will also need to add the <code>greet</code> option to the <code><a class="el" href="goto__instrument__parse__options_8h.html" title="Command Line Parsing.">goto_instrument_parse_options.h</a></code> file in order for this to work. Notice that in the <code>.h</code> file, options that take an argument are followed by a colon (like <code>(property):</code>), while simple switches have no colon. Make sure that you <code>return 0;</code> after printing the message.</p>
<p>The idea behind <code>goto-instrument</code> is that it parses a goto-program and then performs one single analysis on that goto-program, and then returns. Each of the switches in <code>doit</code> function of <code>goto_instrument_parse_options</code> does something different with the goto-program that was supplied on the command line.</p>
<h3><a class="anchor" id="autotoc_md202"></a>
Goto-program basics</h3>
<p>At this point in <code>goto-instrument_parse_options</code> (where the <code>if</code> statements are), the goto-program will have been loaded into the object <code>goto_functions</code>, of type <code><a class="el" href="classgoto__functionst.html" title="A collection of goto functions.">goto_functionst</a></code>. This has a field called <code>function_map</code>, a map from function names to functions.</p>
<div class="memdoc"> <b>Task:</b> Add a <code>--print-function-names</code> switch to <code>goto-instrument</code> that prints out the name of every function in the goto-binary. Are there any functions that you didn't expect to see? </div><p>The following is quite difficult to follow from doxygen, but: the value type of <code>function_map</code> is <code>goto_function_templatet&lt;<a class="el" href="classgoto__programt.html" title="A generic container class for the GOTO intermediate representation of one function.">goto_programt</a>&gt;</code>.</p>
<div class="memdoc"> <b>Task:</b> Read the documentation for <code>goto_function_templatet&lt;bodyT&gt;</code> and <code><a class="el" href="classgoto__programt.html" title="A generic container class for the GOTO intermediate representation of one function.">goto_programt</a></code>. </div><p>Each <a class="el" href="classgoto__programt.html">goto_programt</a> object contains a list of <a class="el" href="classgoto__programt_1_1instructiont.html">goto_programt::instructiont</a> called <code>instructions</code>. Each instruction has a field called <code>code</code>, which has type <a class="el" href="classcodet.html">codet</a>.</p>
<div class="memdoc"> <b>Task:</b> Add a <code>--pretty-program</code> switch to <code>goto-instrument</code>. This switch should use the <code><a class="el" href="classirept.html#a0fd0f0b7d9f7e9a01f503d596333eb06">codet::pretty()</a></code> function to pretty-print every <a class="el" href="classcodet.html">codet</a> in the entire program. The strings that <code>pretty()</code> generates for a codet look like this: </div> <pre class="fragment">index
  * type: unsignedbv
      * width: 8
      * #c_type: char
  0: symbol
      * type: array
          * size: nil
              * type:
          * #source_location:
            * file: src/main.c
            * line: 18
            * function:
            * working_directory: /some/dir
          0: unsignedbv
              * width: 8
              * #c_type: char
...
</pre><p> The sub-nodes of a particular node in the pretty representation are numbered, starting from 0. They can be accessed through the <code>op0()</code>, <code>op1()</code> and <code>op2()</code> methods in the <code>exprt</code> class.</p>
<p>Every node in the pretty representation has an identifier, accessed through the <code>id()</code> function. The file <code>util/irep_ids.def</code> lists the possible values of these identifiers; have a quick scan through that file. In the pretty representation above, the following facts are true of that particular node:</p>
<ul>
<li><code>node.id() == ID_index</code></li>
<li><code>node.type().id() == ID_unsignedbv</code></li>
<li><code>node.op0().id() == ID_symbol</code></li>
<li><code>node.op0().type().id() == ID_array</code></li>
</ul>
<p>The fact that the <code>op0()</code> child has a <code>symbol</code> ID means that you could cast it to a <code><a class="el" href="classsymbol__exprt.html" title="Expression to hold a symbol (variable)">symbol_exprt</a></code> (which is a subtype of <code>exprt</code>) using the function <code>to_symbol_expr</code>.</p>
<div class="memdoc"> <b>Task:</b> Add flags to <code>goto-instrument</code> to print out the following information: </div><ul>
<li>the name of every function that is <em>called</em> in the program;</li>
<li>the value of every constant in the program;</li>
<li>the value of every symbol in the program.</li>
</ul>
<p>Last modified: 2024-06-17 23:32:11 +0200 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Documentation</a></li><li class="navelem"><a class="el" href="cprover_documentation.html">CProver documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
