<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: modeling-mmio</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">modeling-mmio </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h2><a class="anchor" id="modeling-memory-mapped-io"></a>
Modeling Memory-mapped I/O</h2>
<p>Input and output between CPU and devices is facilitated using <a href="https://en.wikipedia.org/wiki/Memory-mapped_I/O">port-mapped or memory-mapped I/O</a>. The former uses dedicated instructions, while the latter uses read or write access to specific locations in memory. In absence of any further modeling, CBMC would consider such accesses out-of-bounds (cf.&#160;<a class="el" href="md_properties.html">program properties</a>). Furthermore, reads or writes to these specific memory locations may result in the device exhibiting some behavior. Both situations require modeling to ensure that CBMC can perform verification that is faithful to the behavior exhibited in concrete execution.</p>
<h3><a class="anchor" id="declaring-memory-mapping"></a>
Declaring memory mapping</h3>
<p>When low-level code uses memory-mapped I/O to access a device, registers of the device are mapped to specific locations in memory. Code reads or writes a register in the device by reading or writing a specific location in memory. For example, if the second bit in a configuration register is to be set, and if that configuration register is mapped to the byte at location 0x1000 in memory, then code sets the second bit of the byte at 0x1000. The problem posed by memory-mapped I/O is that there is no declaration or allocation in the source code specifying this location 0x1000 as a valid region of memory. Nevertheless accesses within this region are valid memory accesses, and should not be flagged as an out-of-bounds memory reference. This is an example of implementation-defined behavior that must be modeled to avoid reporting false positives.</p>
<p>CBMC uses the built-in function <code>__CPROVER_allocated_memory(address, size)</code> to mark ranges of memory as valid. Accesses within this region are exempt from the out-of-bounds assertion checking that CBMC would normally do. The function declares the half-open interval [address, address + size) as valid memory that can be read and written.</p>
<p>This function can be used anywhere in the source code, but is most commonly used in the verification harness. Note that there is no flow sensitivity or scope restriction: CBMC considers accesses to memory regions marked as above valid for read or write access even before the call to the built-in function is encountered.</p>
<h3><a class="anchor" id="device-behavior"></a>
Device behavior</h3>
<p>A memory-mapped I/O region is an interface to a device. Values returned by reading and writing this region of memory need not follow the semantics of ordinary read-write memory. Imagine a device that can generate unique identifiers. If the register returning the unique id is mapped to the byte at location 0x1000, then reading location 0x1000 will return a different value every time, even without intervening writes. These side effects have to be modeled. One easy approach is to ‘havoc’ the device, meaning that writes are ignored and reads return non-deterministic values. This is sound, but may lead to too many false positives. To model the device semantics more precisely, use one of the options described below.</p>
<p><em>If the device has an API,</em> havoc the device by removing the implementation using <code>goto-instrument</code>’s <code>--remove-function-body</code> command-line parameter. Assume the API is called <code>device_access</code>. Using <code>goto-instrument --remove-function-body device_access</code> will drop the implementation of the function device_access from compiled object code. If there is no other definition of <code>device_access</code>, CBMC will model each invocation of <code>device_access</code> as returning an unconstrained value of the appropriate return type. Now, to havoc a device with an API that includes a read and write method, use this command-line option to remove their function bodies, and CBMC will model each invocation of read as returning an unconstrained value. At link time, if another object file, such as the test harness, provides a second definition of <code>device_access</code>, CBMC will use this definition in its place. Thus, to model device semantics more precisely, provide a device model in the verification harness by providing implementations of (or approximations for) the methods in the API.</p>
<p><em>If the device has no API,</em> meaning that the code refers directly to the address in the memory-mapped I/O region for the device without reference to accessor functions, use</p>
<div class="fragment"><div class="line">__CPROVER_mm_io_r(address, size)</div>
<div class="line">__CPROVER_mm_io_w(address, size, value)</div>
</div><!-- fragment --><p>to model the reading or writing of an address at a fixed integer address. If the test harness provides implementations of these functions, CBMC will use these functions to model every read or write of memory. For example, defining</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> __CPROVER_mm_io_r(<span class="keywordtype">void</span> *a, <span class="keywordtype">unsigned</span> s) {</div>
<div class="line">  <span class="keywordflow">if</span>(a == 0x1000)</div>
<div class="line">    <span class="keywordflow">return</span> 2;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">return</span> nondet_char();</div>
<div class="line">}</div>
</div><!-- fragment --><p>will return the value 2 upon any access at address 0x1000, and return a non-deterministic value in all other cases.</p>
<p>Last modified: 2024-02-13 13:55:01 +0100 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
