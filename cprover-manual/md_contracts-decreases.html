<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: contracts-decreases</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">contracts-decreases </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h1><a class="anchor" id="decreases-clauses"></a>
Decreases Clauses</h1>
<p>A <em>decreases</em> clause specifies a measure that must strictly decrease at every iteration of a loop. By demonstrating that the measure</p>
<ol type="1">
<li>is bounded from below, and</li>
<li>strictly decreases at each iteration</li>
</ol>
<p>we can prove termination of loops. This is because the measure must eventually hit the lower bound at which point the loop must terminate, since the measure cannot strictly decrease further. This technique for proving termination was proposed by Robert Floyd, and interested readers may refer to his seminal paper “<a href="https://people.eecs.berkeley.edu/~necula/Papers/FloydMeaning.pdf"><em>Assigning Meaning to Programs</em></a>”.</p>
<h3><a class="anchor" id="syntax"></a>
Syntax</h3>
<p>A one-dimensional (1D) decreases clause for a loop is an arithmetic expression <code>e</code> over the variables visible at the same scope as the loop, specified as <code>__CPROVER_decreases(e)</code>.</p>
<p>Like invariant clauses, decreases clauses may be specified just after the loop guard. An example of a 1D decreases clause is shown below.</p>
<div class="fragment"><div class="line">for(int i = 0; i &lt; n; i += 2)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i &amp;&amp; i &lt;= n)</div>
<div class="line">__CPROVER_decreases(n - i)</div>
<div class="line">{ ... }</div>
</div><!-- fragment --><p>Please see the <a class="el" href="md_contracts-invariants.html">invariant clauses</a> page for more examples on <code>for</code> and <code>do...while</code> loops.</p>
<p>To help prove termination of more complex loops, CBMC also supports multi-dimensional decreases clauses. A multi-dimensional decreases clause is an <a href="https://en.wikipedia.org/wiki/Tuple">ordered tuple</a> of arithmetic expressions, specified as <code>__CPROVER_decreases(e_1, e_2, ..., e_n)</code>. An example of a multi-dimensional decreases clause is given below.</p>
<div class="fragment"><div class="line">while(i &lt; n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i &amp;&amp; i &lt;= n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= j &amp;&amp; j &lt;= n)</div>
<div class="line">__CPROVER_decreases(n - i, n - j)</div>
<div class="line">{</div>
<div class="line">  if (j &lt; n)</div>
<div class="line">    j++;</div>
<div class="line">  else</div>
<div class="line">  {</div>
<div class="line">    i++;</div>
<div class="line">    j = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>We extend the strict arithmetic comparison for 1D decreases clauses to a strict <a href="https://en.wikipedia.org/wiki/Lexicographic_order">lexicographic comparison</a> for multi-dimensional decreases clauses.</p>
<p><b>Important.</b> Like invariant clauses, decreases clauses must be free of side effects, for example, mutation of local or global variables. Otherwise, CBMC raises an error message during compilation: </p><pre class="fragment">Decreases clause is not side-effect free. (at: file main.c line 4 function main) 
</pre><h3><a class="anchor" id="semantics"></a>
Semantics</h3>
<p>A decreases clause extends the loop abstraction introduced in the <a class="el" href="md_contracts-invariants.html">invariants clause</a> manual. In addition to the inductiveness check asserted at the end of a single arbitrary iteration, CBMC would also assert the strict decrement of the measure specified in the decreases clause. At a high level, in addition to the assumptions and assertions introduced by the invariant clause, a decreases clause expands to three key steps: 1. At the beginning of the loop body, record the initial value of the measure specified in the decreases clause. 2. At the end of the loop body, record the final value of the measure specified in the decreases clause. 3. After the loop iteration, assert that the final value is strictly smaller than the initial one.</p>
<p>For a 1D decreases clause, we use the strict arithmetic comparison (i.e., <code>&lt;</code>). For a multi-dimensional decreases clause, say <code>(e_1, ..., e_n)</code>, we extend the strict arithmetic comparison to a strict lexicographic comparison.</p>
<p>As an example, consider our binary search implementation again, this time with a decreases clause annotation to prove its termination:</p>
<div class="fragment"><div class="line">int binary_search(int val, int *buf, int size)</div>
<div class="line">{</div>
<div class="line">  if(size &lt;= 0 || buf == NULL) return NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  long long lb = 0, ub = size - 1;</div>
<div class="line">  long long mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  while(lb &lt;= ub)</div>
<div class="line">  __CPROVER_loop_invariant(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size)</div>
<div class="line">  __CPROVER_loop_invariant(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1)</div>
<div class="line">  __CPROVER_decreases(ub - lb)</div>
<div class="line">  {</div>
<div class="line">     if(buf[mid] == val) break;</div>
<div class="line">     if(buf[mid] &lt; val)</div>
<div class="line">       lb = mid + 1;</div>
<div class="line">     else</div>
<div class="line">       ub = mid - 1;</div>
<div class="line">     mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line">  }</div>
<div class="line">  return lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The instrumented GOTO program is conceptually similar to the following high-level C program:</p>
<div class="fragment"><div class="line">int binary_search(int val, int *buf, int size)</div>
<div class="line">{</div>
<div class="line">  if(size &lt;= 0 || buf == NULL) return NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  long long lb = 0, ub = size - 1;</div>
<div class="line">  long long mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  /* 1. assert invariant at loop entry */</div>
<div class="line">  assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  assert(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  /* 2. create a non-deterministic state for modified variables */</div>
<div class="line">  havoc(lb, ub, mid);</div>
<div class="line"> </div>
<div class="line">  /* 3. establish invariant to model state at an arbitrary iteration */</div>
<div class="line">  __CPROVER_assume(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  __CPROVER_assume(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  /* 4. perform a single arbitrary iteration (or exit the loop) */</div>
<div class="line">  if(lb &lt;= ub)</div>
<div class="line">  {</div>
<div class="line">    /* 5. declare variables for tracking the loop variant */</div>
<div class="line">    int old_measure, new_measure;</div>
<div class="line"> </div>
<div class="line">    /* 6. evaluate the variant at the start of the loop body */</div>
<div class="line">    old_measure = ub - lb;</div>
<div class="line"> </div>
<div class="line">    if(buf[mid] == val) break;</div>
<div class="line">    if(buf[mid] &lt; val)</div>
<div class="line">      lb = mid + 1;</div>
<div class="line">    else</div>
<div class="line">      ub = mid - 1;</div>
<div class="line">    mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">    /* 7. assert the invariant to establish inductiveness */</div>
<div class="line">    assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">    assert(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">    /* 8. evaluate the variant at the end of the loop body */</div>
<div class="line">    new_measure = ub - lb;</div>
<div class="line"> </div>
<div class="line">    /* 9. assert the decreases clause */</div>
<div class="line">    assert(new_measure &lt; old_measure);</div>
<div class="line"> </div>
<div class="line">    /* 10. terminate this symbolic execution path; similar to &quot;exit&quot; */</div>
<div class="line">    __CPROVER_assume(false);</div>
<div class="line">  }</div>
<div class="line">  return lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The instrumented code points (5), (6), (8), and (9) are specific to the decreases clause.</p>
<p><b>Important.</b> Decreases clauses work in conjunction with <a class="el" href="md_contracts-invariants.html">loop invariants</a>, which model an arbitrary loop iteration at which the decreases clause is checked. If a decreases clause is annotated on a loop without an invariant clause, then the weakest possible invariant (i.e, <code>true</code>) is used to model an arbitrary iteration.</p>
<p>Last modified: 2022-10-31 09:43:23 +0000 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
