<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: smt2-incr</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">smt2-incr </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h2><a class="anchor" id="smt-2-incremental-backend"></a>
SMT 2 incremental backend</h2>
<p>CBMC supports many different smt solver backends. This document describes how to use the incremental smt2 solver. For other solver usages use <code>cbmc --help</code>.</p>
<p>The incremental smt2 solver backend of CBMC is a solver-agnostic smt backend that allows the user to specify which smtlib 2.6 compliant solver CBMC should use. This choice increases the flexibility of CBMC as the user can easily switch solver at runtime also allowing custom parametrization of the solver to be used. Further, the backend exploits the incremental mode of the smt solver, so subsequent incremental SMT solver queries do not require a full re-evaluation of the entire SMT formula.</p>
<h3><a class="anchor" id="supported-features"></a>
Supported features</h3>
<p>The incremental smt2 solver supports the following CBMC C features:</p>
<ul>
<li>Integral types (including integers, characters and boolean). These are encoded into smt by using bit-vectors,</li>
<li>Pointers. Encoded by using smt bit-vectors. This includes support for pointers to both stack and heap-allocated memory,</li>
<li>Arrays. Encoded by using smt array theory.</li>
</ul>
<p>Currently, unsupported features include floating-point types, structs and unions.</p>
<p>For more details on which features are supported see regression tests in `regression/cbmc-incr-smt2`.</p>
<p>The backend has been tested with these instrumentation passes:</p>
<ul>
<li><code>--bounds-check</code>,</li>
<li><code>--conversion-check</code>,</li>
<li><code>--div-by-zero-check</code>,</li>
<li><code>--pointer-check</code>,</li>
<li><code>--pointer-overflow-check</code>,</li>
<li><code>--signed-overflow-check</code>,</li>
<li><code>--unsigned-overflow-check</code>,</li>
<li><code>--unwinding-assertions</code>.</li>
</ul>
<h3><a class="anchor" id="requisites"></a>
Requisites</h3>
<p>To run the incremental smt2 backend it is necessary to have an smt solver that:</p>
<ul>
<li>is runnable from the command line,</li>
<li>supports interactive mode from the command line,</li>
<li>supports smtlib 2.6 input,</li>
<li>supports incremental mode.</li>
</ul>
<p>Because of the way supported features are encoded the smt solver should be capable to handle arrays, bit-vectors, uninterpreted functions and quantifiers. Also, the solver should work with the <code>ALL</code> smt theory.</p>
<p>At the time of writing the smt solvers tested in CI are <a href="https://github.com/Z3Prover/z3">Z3</a> and <a href="https://cvc5.github.io/">CVC5</a>.</p>
<h3><a class="anchor" id="usage"></a>
Usage</h3>
<p>To use the incremental SMT2 backend it is enough to add the <code>--incremental-smt2-solver</code> argument to the CBMC command line followed by the command to invoke the chosen solver using smtlib 2.6 input in interactive mode.</p>
<p>Here are two examples to show how to analyse a file <code>program.c</code> using Z3 and CVC5 solvers.</p>
<p>To use the Z3 SMT solver:</p>
<div class="fragment"><div class="line">cbmc --incremental-smt2-solver &#39;z3 -smt2 -in&#39; program.c</div>
</div><!-- fragment --><p>If <code>z3</code> is not on the <code>PATH</code>, then it is enough to replace &lsquo;'z3 -smt2 -in&rsquo;<code>with</code>'&lt;command-to-execute-z3&gt; -smt2 -in'`,</p>
<p>Similarly to execute CBMC using the CVC5 solver:</p>
<div class="fragment"><div class="line">cbmc --incremental-smt2-solver &#39;cvc5 --lang=smtlib2.6 --incremental&#39; program.c</div>
</div><!-- fragment --><p>As the command to execute the solver is left to the user, it is possible to fine-tune it by passing extra parameters (when the solver allows so). For example Z3 allows to set certain parameters by adding <code>param_name=value</code> to the command line, so to use the Z3 solver with <code>well_sorted_check</code> property set to <code>false</code> the following has to be run:</p>
<div class="fragment"><div class="line">cbmc --incremental-smt2-solver &#39;z3 -smt2 -in well_sorted_check=false&#39; program.c</div>
</div><!-- fragment --><h3><a class="anchor" id="examples"></a>
Examples</h3>
<p>Given a C program <code>program.c</code> as follows:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> x, y;</div>
<div class="line">  <span class="keywordflow">if</span>(x != 0)</div>
<div class="line">    __CPROVER_assert(y != 4, <span class="stringliteral">&quot;Assert of inequality to 4.&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    __CPROVER_assert(y != 2, <span class="stringliteral">&quot;Assert of inequality to 2.&quot;</span>);</div>
<div class="line">  <span class="keywordtype">int</span> z = y;</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To analyze it we should run:</p>
<div class="fragment"><div class="line">cbmc --incremental-smt2-solver &#39;z3 -smt2 -in&#39; program.c</div>
</div><!-- fragment --><p>We will get the verification results as follows:</p>
<div class="fragment"><div class="line">CBMC version 5.70.0 (cbmc-5.70.0-53-g20535ad14d) 64-bit x86_64 macos</div>
<div class="line">Parsing program.c</div>
<div class="line">Converting</div>
<div class="line">Type-checking program</div>
<div class="line">Generating GOTO Program</div>
<div class="line">Adding CPROVER library (x86_64)</div>
<div class="line">Removal of function pointers and virtual functions</div>
<div class="line">Generic Property Instrumentation</div>
<div class="line">Running with 8 object bits, 56 offset bits (default)</div>
<div class="line">Starting Bounded Model Checking</div>
<div class="line">Runtime Symex: 0.00168879s</div>
<div class="line">size of program expression: 45 steps</div>
<div class="line">slicing removed 23 assignments</div>
<div class="line">Generated 2 VCC(s), 2 remaining after simplification</div>
<div class="line">Runtime Postprocess Equation: 2.1865e-05s</div>
<div class="line">Passing problem to incremental SMT2 solving via &quot;z3 -smt2 -in&quot;</div>
</div><!-- fragment --><p>Note here that the solver used by CBMC is <code>"z3 -smt2 -in"</code> as specified by the user.</p>
<div class="fragment"><div class="line">[continues]</div>
<div class="line">converting SSA</div>
<div class="line">Runtime Convert SSA: 0.00130809s</div>
<div class="line">Running incremental SMT2 solving via &quot;z3 -smt2 -in&quot;</div>
<div class="line">Runtime Solver: 0.0738685s</div>
<div class="line">Runtime decision procedure: 0.0765297s</div>
<div class="line">Running incremental SMT2 solving via &quot;z3 -smt2 -in&quot;</div>
<div class="line">Runtime Solver: 0.00535358s</div>
<div class="line">Runtime decision procedure: 0.00570765s</div>
<div class="line"> </div>
<div class="line">** Results:</div>
<div class="line">program.c function main</div>
<div class="line">[main.assertion.1] line 5 Assert of inequality to 4.: FAILURE</div>
<div class="line">[main.assertion.2] line 7 Assert of inequality to 2.: FAILURE</div>
<div class="line"> </div>
<div class="line">** 2 of 2 failed (3 iterations)</div>
<div class="line">VERIFICATION FAILED</div>
</div><!-- fragment --><p>As expected CBMC returns <code>FAILURE</code> for both assertions at lines <code>5</code> and <code>7</code>.</p>
<p>The incremental smt2 backend also supports trace generation, so to get a trace that fails the assertions the <code>--trace</code> argument should be added, so the command to run is:</p>
<div class="fragment"><div class="line">cbmc --incremental-smt2-solver &#39;z3 -smt2 -in&#39; --trace program.c</div>
</div><!-- fragment --><p>This will append the trace to CBMC’s output as follows:</p>
<div class="fragment"><div class="line">CBMC version 5.70.0 (cbmc-5.70.0-53-g20535ad14d) 64-bit x86_64 macos</div>
<div class="line">Parsing program.c</div>
<div class="line">[...]</div>
<div class="line">[main.assertion.1] line 5 Assert of inequality to 4.: FAILURE</div>
<div class="line">[main.assertion.2] line 7 Assert of inequality to 2.: FAILURE</div>
<div class="line"> </div>
<div class="line">Trace for main.assertion.1:</div>
<div class="line"> </div>
<div class="line">State 6 file program.c function main line 3 thread 0</div>
<div class="line">----------------------------------------------------</div>
<div class="line">  x=-1 (11111111 11111111 11111111 11111111)</div>
<div class="line"> </div>
<div class="line">State 7 file program.c function main line 3 thread 0</div>
<div class="line">----------------------------------------------------</div>
<div class="line">  y=4 (00000000 00000000 00000000 00000100)</div>
<div class="line"> </div>
<div class="line">Violated property:</div>
<div class="line">  file program.c function main line 5 thread 0</div>
<div class="line">  Assert of inequality to 4.</div>
<div class="line">  y != 4</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Trace for main.assertion.2:</div>
<div class="line"> </div>
<div class="line">State 6 file program.c function main line 3 thread 0</div>
<div class="line">----------------------------------------------------</div>
<div class="line">  x=0 (00000000 00000000 00000000 00000000)</div>
<div class="line"> </div>
<div class="line">State 7 file program.c function main line 3 thread 0</div>
<div class="line">----------------------------------------------------</div>
<div class="line">  y=2 (00000000 00000000 00000000 00000010)</div>
<div class="line"> </div>
<div class="line">Violated property:</div>
<div class="line">  file program.c function main line 7 thread 0</div>
<div class="line">  Assert of inequality to 2.</div>
<div class="line">  y != 2</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">** 2 of 2 failed (3 iterations)</div>
<div class="line">VERIFICATION FAILED</div>
</div><!-- fragment --><p>Last modified: 2024-08-21 10:02:55 +0200 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
