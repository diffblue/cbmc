<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: static-functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">static-functions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h2><a class="anchor" id="modular-verification-of-static-functions"></a>
Modular Verification of Static Functions</h2>
<p>This page describes how to use CBMC on static functions.</p>
<p>CBMC can check libraries and other codebases that expose several entry points. To do this, users typically write a <em>harness</em> that captures the entry points’ API contract, and that calls into the API with unconstrained values. The example below shows such a library and harness:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> public_api_function(<span class="keyword">const</span> <span class="keywordtype">int</span> *a, <span class="keywordtype">int</span> *b)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  private_function(a, b);</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> private_function(<span class="keyword">const</span> <span class="keywordtype">int</span> *a, <span class="keywordtype">int</span> *b)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The harness sets up some assumptions and then calls into the API:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> public_api_function(<span class="keywordtype">int</span> *a, <span class="keywordtype">int</span> *b);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> harness()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> a, b;</div>
<div class="line">  __CPROVER_assume(a &lt; 10);</div>
<div class="line">  __CPROVER_assume(a &gt;= 0);</div>
<div class="line">  public_api_function(&amp;a, &amp;b);</div>
<div class="line">  __CPROVER_assert(b != a);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The following commands build and check this function:</p>
<div class="fragment"><div class="line">&gt; goto-cc -c -o library.o library.c</div>
<div class="line">&gt; goto-cc -c -o harness.o harness.c</div>
<div class="line">&gt; goto-cc -o to_check.gb library.o harness.o</div>
<div class="line">&gt; cbmc --function harness to_check.gb</div>
</div><!-- fragment --><h3><a class="anchor" id="stubbing-out-static-functions"></a>
Stubbing out static functions</h3>
<p>For performance reasons, it might be desirable to analyze the API function independently of the static function. We can analyze the API function by “stubbing out” the static function, replacing it with a function that does nothing apart from asserting that its inputs satisfy the function’s contract. (“Stubbing out” a function is sometimes known as “modelling” or “abstracting it out”.) Add the following to <code>harness.c</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> private_function(<span class="keyword">const</span> <span class="keywordtype">int</span> *a, <span class="keywordtype">int</span> *b)</div>
<div class="line">{</div>
<div class="line">  __CPROVER_assert( private_function_precondition );</div>
<div class="line">  __CPROVER_assume( private_function_postcondition );</div>
<div class="line">}</div>
</div><!-- fragment --><p>And build as follows, stripping the original static function out of its object file:</p>
<div class="fragment"><div class="line">&gt; goto-cc -c -o library.o library.c</div>
<div class="line">&gt; goto-instrument --remove-function-body private_function library.o library-no-private.o</div>
<div class="line">&gt;</div>
<div class="line">&gt; goto-cc -c -o harness.o harness.c</div>
<div class="line">&gt;</div>
<div class="line">&gt; # The stub in the harness overrides the implementation of</div>
<div class="line">&gt; # private_function whose body has been removed</div>
<div class="line">&gt; goto-cc -o to_check.gb library-no-private.o harness.o</div>
<div class="line">&gt; cbmc --function harness to_check.gb</div>
</div><!-- fragment --><h3><a class="anchor" id="separately-checking-static-functions"></a>
Separately checking static functions</h3>
<p>We should now also write a harness for <code>private_function</code>. However, since that function is marked <code>static</code>, it is not possible for functions in external files to call it. We can write and link a harness by stripping the <code>static</code> attribute from <code>private_function</code> using goto-cc’s <code>--export-file-local-symbols</code> flag.</p>
<div class="fragment"><div class="line">&gt; goto-cc -c -o --export-file-local-symbols library_with_static.o library.c</div>
</div><!-- fragment --><p><code>library_with_static.o</code> now contains an implementation of <code>private_function()</code> with a mangled name. We can display the mangled name with goto-instrument:</p>
<div class="fragment"><div class="line">&gt; goto-instrument --show-symbol-table library_with_static.o | grep -B1 -A1 &quot;Pretty name.: private_function&quot;</div>
<div class="line">Symbol......: __CPROVER_file_local_library_c_private_function</div>
<div class="line">Pretty name.: private_function</div>
<div class="line">Module......: private_function</div>
</div><!-- fragment --><p>When we write a harness for the static function, we ensure that we call the mangled name:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> harness()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> a, b;</div>
<div class="line"> </div>
<div class="line">  __CPROVER_assume( private_function_precondition );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Call the static function</span></div>
<div class="line">  __CPROVER_file_local_library_c_private_function(&amp;a, &amp;b);</div>
<div class="line"> </div>
<div class="line">  __CPROVER_assert( private_function_postcondition );</div>
<div class="line">}</div>
</div><!-- fragment --><p>We can then link this harness to the object file with exported symbols and run CBMC as usual.</p>
<div class="fragment"><div class="line">&gt; goto-cc -c -o private_harness.o private_harness.c</div>
<div class="line">&gt; goto-cc -o to_test.gb private_harness.o library_with_static.o</div>
<div class="line">&gt; cbmc --function harness to_test.gb</div>
</div><!-- fragment --><p>It is possible that CBMC will generate the same mangled name for two different static functions. This happens when the functions have the same name and are written in same-named files that live in different directories. In the following codebase, the two <code>qux</code> functions will both have their names mangled to <code>__CPROVER_file_local_b_c_qux</code>, and so any harness that requires both of those files will fail to link. </p><pre class="fragment">    project
    |
    \_ foo
    |  |
    |  \_ a.c
    |  \_ b.c &lt;- contains static function "qux"
    |
    \_ bar
       |
       \_ c.c
       \_ b.c &lt;- also contains static function "qux"
</pre><p> The solution is to use the <code>--mangle-suffix</code> option to goto-cc. This allows you to specify a different suffix for name-mangling. By specifying a custom, different suffix for each of the two files, the mangled names are unique and the files can be successfully linked.</p>
<p>More examples are in <code>regression/goto-cc-file-local</code>.</p>
<p>Last modified: 2024-03-15 16:23:31 +0100 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
