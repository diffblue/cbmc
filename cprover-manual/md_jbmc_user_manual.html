<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: jbmc-user-manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">jbmc-user-manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h1><a class="anchor" id="verifying-java-with-jbmc"></a>
Verifying Java with JBMC</h1>
<h2><a class="anchor" id="introduction"></a>
Introduction</h2>
<p>JBMC is a bounded model checking tool for the Java language. It follows the same principles as CBMC, thus the existing <a class="el" href="md_cbmc_tutorial.html">documentation for CBMC</a> largely applies to JBMC.</p>
<p>In brief, JBMC creates a model from Java Bytecode (given as input as a <code>.class</code> file or a <code>.jar</code>) and performs static analysis and symbolic execution which allow us to prove or refute properties. These properties are either automatically generated (runtime errors), or provided by the user in the form of assertions.</p>
<p>Using examples, the following section will guide you through the basic features of JBMC.</p>
<h2><a class="anchor" id="jbmc-tutorial"></a>
JBMC tutorial</h2>
<h3><a class="anchor" id="automatic-assertions"></a>
Automatic assertions</h3>
<p>Consider the following simplistic <code>ExampleArray.java</code> file which we have compiled into <code>tutorial/ExampleArray.class</code> and which queries the array of input arguments at index 3: </p><pre class="fragment"> 1| package tutorial;
 2|
 3| public class ExampleArray {
 4|
 5|     public static void main(String[] args) {
 6|         final int index = 3;
 7|         String arg3 = args[index];
 8|     }
 9|
10| }
</pre><p> Now let’s run the following command to let JBMC tell us about potential errors in our program. </p><pre class="fragment">$ jbmc tutorial.ExampleArray
</pre><p> The output contains the following:</p>
<div class="fragment"><div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.null-pointer-exception.1] line 7 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.array-index-out-of-bounds-low.1] line 7 Array index should be &gt;= 0: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.array-index-out-of-bounds-high.1] line 7 Array index should be &lt; length: FAILURE</div>
<div class="line">[java::tutorial.ExampleArray.main:([Ljava/lang/String;)V.1] line 7 no uncaught exception: SUCCESS</div>
<div class="line"> </div>
<div class="line">** 1 of 13 failed (2 iterations)</div>
<div class="line">VERIFICATION FAILED</div>
</div><!-- fragment --><p>We have a reported failure: JBMC found that the array access could potentially be out of bounds, if the size of the argument array is too small.</p>
<p>If we make our code more robust by adding guards to make the array access safe as follows: </p><pre class="fragment">  1| package tutorial;
  2|
  3| public class ExampleArraySafe {
  4|
  5|     public static void main(String[] args) {
  6|         final int index = 3;
  7|         String arg3 = "none";
  8|         if (index &lt; args.length) {
  9|             arg3 = args[index];
 10|         }
 11|     }
 12|
 13| }
</pre><p> then when running JBMC on that corrected version: </p><pre class="fragment">$ jbmc tutorial.ExampleArraySafe
</pre><p> all the automatic assertions become valid, meaning that there is no possible inputs (argument values) for which they can be violated:</p>
<div class="fragment"><div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.1] line 7 no uncaught exception: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.null-pointer-exception.1] line 8 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.null-pointer-exception.2] line 9 Null pointer check: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.array-index-out-of-bounds-low.1] line 9 Array index should be &gt;= 0: SUCCESS</div>
<div class="line">[java::tutorial.ExampleArraySafe.main:([Ljava/lang/String;)V.array-index-out-of-bounds-high.1] line 9 Array index should be &lt; length: SUCCESS</div>
</div><!-- fragment --><h2><a class="anchor" id="loop-unwinding"></a>
Loop Unwinding</h2>
<p>As CBMC, JBMC needs to unwind loops up to a given value. Consider the <code>isPrime</code> method in the code below. Without specifying an unwind limit, JBMC will not terminate when analyzing the following function whose state representation is theoretically unbounded (because of the for-loop whose number of iterations depends on an input): </p><pre class="fragment"> 1| package tutorial;
 2|
 3| public class ExampleUnwind {
 4|
 5|     public static void doSomething(int inputVal) {
 6|         if (inputVal &gt; 1 &amp;&amp; inputVal % 2 == 1) {
 7|             assert isPrime(inputVal);
 8|             // do something
 9|         }
10|     }
11|
12|     public static boolean isPrime(int candidate) {
13|         for (int div = 2; div * div &lt;= candidate; div++) {
14|             if (candidate % div == 0) {
15|                 return false;
16|             }
17|         }
18|         return candidate &gt; 1;
19|     }
20|
21| }
</pre><p> To limit the number of times the for-loop is unwound, we use the <code>--unwind N</code> options, in which case the following call to JBMC: </p><pre class="fragment">$ jbmc tutorial.ExampleUnwind.isPrime --unwind 10
</pre><p> will terminate correctly. In this case, we will see <code>VERIFICATION SUCCESSFUL</code>, as no automatic assertions are violated.</p>
<p>Note that in that example, there are is no main function, so we give specify the desired entry point via the <code>--function</code> option.</p>
<h2><a class="anchor" id="user-assertions"></a>
User assertions</h2>
<p>Elaborating on the example above, users may provide their own assertions, that JBMC will try to refute. On line 7, we check the assertion that all odd numbers greater than 1 are prime. To be sure that this always holds, we run JBMC on the example, with a reasonable <code>unwind</code> value: </p><pre class="fragment">$ jbmc tutorial.ExampleUnwind.doSomething --unwind 10
</pre><p> Unsurprisingly JBMC doesn’t agree, and prints an assertion failure (truncated here for readability):</p>
<div class="fragment"><div class="line">[...doSomething:(I)V.assertion.1] line 7 assertion at file tutorial/ExampleUnwind.java: FAILURE</div>
</div><!-- fragment --><p>Rerunning the analysis with the <code>--trace</code> option, the following line appears somewhere in the trace output and tells us which input value JBMC found to trigger the violation (note that to see the original parameter names in the trace output, the Java source must be compiled in debug mode: <code>javac -g</code>):</p>
<div class="fragment"><div class="line">INPUT inputVal: 15</div>
</div><!-- fragment --><p>The value chosen by JBMC is arbitrary, and could as well be 9 or 2084569161.</p>
<h2><a class="anchor" id="java-library-support"></a>
Java Library support</h2>
<p>The examples above only involve primitive types. In order to analyse code involving Java Library classes, the core models (located in the same repository) need to be added to the classpath: </p><pre class="fragment">--cp &lt;path_to_cbmc&gt;/jbmc/src/java_bytecode/library/core-models.jar
</pre><p> The core models library simulate the behavior of the Java Library and contains some commonly used classes, such as Object, Class, String, Enum. Some JBMC-specific utilities reside in the <code>org.cprover</code> package.</p>
<p>Using the models, JBMC can reason with a variety of String operations from <code>java.lang.String</code>, e.g. </p><pre class="fragment">  1| package tutorial;
  2|
  3| public class ExampleModels {
  4|
  5|     public static void main(String[] args) {
  6|         StringBuilder sb = new StringBuilder("abcd");
  7|         StringBuilder sb2 = sb.insert(2, "$");
  8|         assert sb2.toString().startsWith("abc");
  9|     }
 10|
 11| }
</pre><p> The following command line (note that the current directory is also added to the classpath): </p><pre class="fragment">$ jbmc tutorial.ExampleModels --cp &lt;path_to_cbmc&gt;/jbmc/src/java_bytecode/library/core-models.jar:.
</pre><p> will flag this violation (truncated):</p>
<div class="fragment"><div class="line">[java::tutorial.ExampleModels.stringOp:()V.assertion.1] line 8 assertion: FAILURE</div>
</div><!-- fragment --><p>Again, the trace (when re-running with <code>--trace</code>) shows the string violating the condition in the assertion:</p>
<div class="fragment"><div class="line">dynamic_object2={ &#39;a&#39;, &#39;b&#39;, &#39;$&#39;, &#39;c&#39;, &#39;d&#39; }</div>
</div><!-- fragment --><h2><a class="anchor" id="exceptions"></a>
Exceptions</h2>
<p>In its analysis, JBMC can take into account exceptions thrown by user code or library classes, as well as runtime exceptions such as NullPointerException. To have JBMC reliably notify about all uncaught exceptions, the <code>--throw-runtime-exceptions</code> can be used.</p>
<p>Consider the following code: </p><pre class="fragment">  1| package tutorial;
  2|
  3| public class ExampleExceptions {
  4|
  5|     public static int strLength(String str) {
  6|         return str.length();
  7|     }
  8|
  9| }
</pre><p> When given the <code>--throw-runtime-exceptions</code> options: </p><pre class="fragment">$ jbmc tutorial.ExampleExceptions.strLength --throw-runtime-exceptions
</pre><p> JBMC will signal that the <code>str.length()</code> call may throw a runtime exception and that this exception is not caught.</p>
<div class="fragment"><div class="line">[java::tutorial.ExampleExceptions.strLength:(Ljava/lang/String;)I.1] line 6 no uncaught exception: FAILURE</div>
</div><!-- fragment --><p>This could be fixed by adding a try-catch statement, or else checking that <code>str</code> is non-null before accessing it.</p>
<p>To silence errors about uncaught exceptions while keeping JBMC’s ability to throw runtime exceptions (for example when analyzing code that has try-catch blocks), the <code>--disable-uncaught-exception-check</code> option can be added. In our example, the assertion check will disappear completely from the output: </p><pre class="fragment">Generated 2 VCC(s), 0 remaining after simplification
VERIFICATION SUCCESSFUL
</pre><p> When analyzing this function without runtime exception support: </p><pre class="fragment">$ jbmc tutorial.ExampleExceptions
</pre><p> JBMC only reports the error as a null pointer check failure: </p><pre class="fragment">[...null-pointer-exception.1] line 6 Null pointer check: FAILURE
[...strLength:(Ljava/lang/String;)I.1] line 6 no uncaught exception: SUCCESS
</pre><p> It is worth noting that in the JVM, <code>assert</code> actually throws an AssertionError on violation. This behavior can be replicated in JBMC by using the <code>--throw-assertion-error</code>. Violations of user assertions (if uncaught) would then be reported like any other uncaught exception.</p>
<h2><a class="anchor" id="further-documentation"></a>
Further documentation</h2>
<p>JBMC has a wealth of other options that can either constrain the model (to cope with complexity issues), or output more relevant information. The list of all available options is printed by running: </p><pre class="fragment">$ jbmc --help
</pre><p> Last modified: 2024-02-06 12:56:54 -0800 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
