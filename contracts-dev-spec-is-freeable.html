<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: Rewriting Calls to __CPROVER_is_freeable and __CPROVER_was_freed Predicates</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('contracts-dev-spec-is-freeable.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Rewriting Calls to __CPROVER_is_freeable and __CPROVER_was_freed Predicates </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_cbmc_cbmc_src_goto_instrument_contracts_doc_developer_contracts_dev_spec_is_freed"></a> Back to top <a class="el" href="contracts-dev-spec.html">Code Contracts Transformation Specification</a></p>
<p>In goto programs encoding pre or post conditions (generated from the contract clauses) and in all user-defined functions, we simply replace calls to <code>__CPROVER_is_freeable</code> with a calls to its library implementation:</p>
<div class="fragment"><div class="line">CALL <a class="code" href="cprover__contracts_8c.html#a94dc1661eaeee9d04229f924a61e9832">__CPROVER_contracts_is_freeable</a>(<span class="keywordtype">void</span> *ptr, <a class="code" href="struct_____c_p_r_o_v_e_r__contracts__write__set__t.html">__CPROVER_contracts_write_set_ptr_t</a> write_set);</div>
<div class="ttc" id="acprover__contracts_8c_html_a94dc1661eaeee9d04229f924a61e9832"><div class="ttname"><a href="cprover__contracts_8c.html#a94dc1661eaeee9d04229f924a61e9832">__CPROVER_contracts_is_freeable</a></div><div class="ttdeci">__CPROVER_bool __CPROVER_contracts_is_freeable(void *ptr, __CPROVER_contracts_write_set_ptr_t set)</div><div class="ttdoc">Implementation of the is_freeable front-end predicate.</div><div class="ttdef"><b>Definition:</b> <a href="cprover__contracts_8c_source.html#l01438">cprover_contracts.c:1438</a></div></div>
<div class="ttc" id="astruct_____c_p_r_o_v_e_r__contracts__write__set__t_html"><div class="ttname"><a href="struct_____c_p_r_o_v_e_r__contracts__write__set__t.html">__CPROVER_contracts_write_set_t</a></div><div class="ttdoc">Runtime representation of a write set.</div><div class="ttdef"><b>Definition:</b> <a href="cprover__contracts_8c_source.html#l00071">cprover_contracts.c:72</a></div></div>
</div><!-- fragment --><p>The behaviour of <code>__CPROVER_contracts_is_freeable</code> can only be used in requires clauses, and it needs to use a weaker definition when used in assumption contexts (contract checking vs replacement). Context flags are obtained from the write set instance an interpreted by the library function.</p>
<p>For <code>__CPROVER_was_freed</code>, which can only be used in post conditions, we also map calls to a library implementation:</p>
<div class="fragment"><div class="line">CALL <a class="code" href="cprover__contracts_8c.html#a947ac49e226fbeab880aa2f195d5daf1">__CPROVER_contracts_was_freed</a>(<span class="keywordtype">void</span> *ptr, <a class="code" href="struct_____c_p_r_o_v_e_r__contracts__write__set__t.html">__CPROVER_contracts_write_set_ptr_t</a> write_set);</div>
<div class="ttc" id="acprover__contracts_8c_html_a947ac49e226fbeab880aa2f195d5daf1"><div class="ttname"><a href="cprover__contracts_8c.html#a947ac49e226fbeab880aa2f195d5daf1">__CPROVER_contracts_was_freed</a></div><div class="ttdeci">__CPROVER_bool __CPROVER_contracts_was_freed(void *ptr, __CPROVER_contracts_write_set_ptr_t set)</div><div class="ttdoc">Returns true iff the pointer ptr is found in set-&gt;deallocated.</div><div class="ttdef"><b>Definition:</b> <a href="cprover__contracts_8c_source.html#l01470">cprover_contracts.c:1470</a></div></div>
</div><!-- fragment --><p>This function performs a lookup in the <code>write_set-&gt;deallocated</code> pointer set to check if the function under analysis indeed deallocated the object. The result of this check will then be either asserted for contract checking or assumed for contract replacement. on the context. When turned in an assumption, we instantiate an extra assertion before the assumption, in order to check that the pointer is in always found in the freeable set of the contract and that it is safe to assume it is freed, without causing an immediate contradiction.</p>
<hr  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Prev   </th><th class="markdownTableHeadLeft">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="contracts-dev.html">Code Contracts Developer Documentation</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="contracts-dev-spec-reminder.html">Function Contracts Reminder</a>   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="contracts-mainpage.html">Code Contracts in CBMC</a></li><li class="navelem"><a class="el" href="contracts-dev.html">Code Contracts Developer Documentation</a></li><li class="navelem"><a class="el" href="contracts-dev-spec.html">Code Contracts Transformation Specification</a></li><li class="navelem"><a class="el" href="contracts-dev-spec-dfcc.html">Dynamic Frame Condition Checking</a></li><li class="navelem"><a class="el" href="contracts-dev-spec-dfcc-instrument.html">GOTO Function Instrumentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
