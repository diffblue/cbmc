<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: GOTO Function Instrumentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('contracts-dev-spec-dfcc-instrument.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">GOTO Function Instrumentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#contracts-dev-spec-dfcc-instrument-signature">Signature Extension</a></li>
<li class="level1"><a href="#contracts-dev-spec-dfcc-instrument-body">Body Instrumentation</a><ul><li class="level2"><a href="#autotoc_md35">Instrumenting DECL Instructions</a></li>
<li class="level2"><a href="#autotoc_md36">Instrumenting DEAD Instructions</a></li>
<li class="level2"><a href="#autotoc_md37">Instrumenting ASSERT Instructions</a></li>
<li class="level2"><a href="#autotoc_md38">Instrumenting ASSUME Instructions</a></li>
<li class="level2"><a href="#autotoc_md39">Instrumenting ASSIGN Instructions</a><ul><li class="level3"><a href="#autotoc_md40">LHS Instrumentation</a></li>
<li class="level3"><a href="#autotoc_md41">RHS Instrumentation</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md42">Instrumenting CALL Instructions</a></li>
<li class="level2"><a href="#autotoc_md43">Instrumenting OTHER Instructions</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_cbmc_cbmc_src_goto_instrument_contracts_doc_developer_contracts_dev_spec_dfcc_instrument"></a> Back to top <a class="el" href="contracts-dev-spec.html">Code Contracts Transformation Specification</a></p>
<p>Applying the DFCC instrumentation to a function turns it into a function that can be checked against a write set passed as parameter.</p>
<h1><a class="anchor" id="contracts-dev-spec-dfcc-instrument-signature"></a>
Signature Extension</h1>
<p>The signature of a function:</p>
<div class="fragment"><div class="line">ret_t foo(foo-parameters);</div>
</div><!-- fragment --><p>is turned into the extended version:</p>
<div class="fragment"><div class="line">ret_t  foo(foo-parameters,  __CPROVER_contracts_write_set_ptr_t write_set);</div>
</div><!-- fragment --><p>After this step the <code>write_set</code> parameter is in scope in the function and can be used to implement checks.</p>
<p>It is valid to pass a <code>NULL</code> pointer for the <code>write_set</code> parameter. When the <code>write_set</code> parameter is NULL, no checks are performed in the function.</p>
<h1><a class="anchor" id="contracts-dev-spec-dfcc-instrument-body"></a>
Body Instrumentation</h1>
<p>Body instrumentation inserts additional goto instructions in the function's GOTO instruction sequence.</p>
<p>All instrumented checks are guarded by a null-check on the <code>write_set</code> pointer parameter. Hence, passing a <code>NULL</code> pointer results in no checks being performed in the function.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Instrumenting DECL Instructions</h2>
<div class="fragment"><div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a> x;</div>
<div class="line">----</div>
<div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line">CALL __CPROVER_contract_write_set_add_allocated(write_set, &amp;x);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a></div><div class="ttdeci">@ SKIP</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00038">goto_program.h:38</a></div></div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a></div><div class="ttdeci">@ DECL</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00047">goto_program.h:47</a></div></div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a></div><div class="ttdeci">@ GOTO</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00034">goto_program.h:34</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Instrumenting DEAD Instructions</h2>
<div class="fragment"><div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line">CALL __CPROVER_contract_write_set_record_dead(write_set, &amp;x);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a> x;</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a></div><div class="ttdeci">@ DEAD</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00048">goto_program.h:48</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
Instrumenting ASSERT Instructions</h2>
<p>No instrumentation is performed.</p>
<div class="fragment"><div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a> expr;</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a></div><div class="ttdeci">@ ASSERT</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00036">goto_program.h:36</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Instrumenting ASSUME Instructions</h2>
<p>No instrumentation is performed.</p>
<div class="fragment"><div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebafb0252b8c02058a48600203a681e1ade">ASSUME</a> expr;</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296bebafb0252b8c02058a48600203a681e1ade"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebafb0252b8c02058a48600203a681e1ade">ASSUME</a></div><div class="ttdeci">@ ASSUME</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00035">goto_program.h:35</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Instrumenting ASSIGN Instructions</h2>
<p>Assign instructions trigger a check on the LHS but also triggers an update of the write set if the RHS if it represents a dynamic allocation or deallocation.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
LHS Instrumentation</h3>
<p>Checks are inserted before the instruction.</p>
<p>If the LHS is either:</p><ul>
<li>a <code>__CPROVER_</code>-prefixed symbol (these symbols are usually global variables that serve instrumentation purposes and can be understood as living in a namespace of their own)</li>
<li>an expression that represents a composite access expression to a locally stack-allocated object that is not dirty (i.e. its address is never computed) or a to a function parameter (these are always implicitly allowed)</li>
</ul>
<p>Then no check is performed, i.e. <code>ASSERT true;</code> is inserted:</p>
<div class="fragment"><div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;comment describing why the assignment is always allowed&quot;</span>);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba52a9b031766fa116251f70e65a84c01a">ASSIGN</a> lhs := rhs;</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296beba52a9b031766fa116251f70e65a84c01a"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba52a9b031766fa116251f70e65a84c01a">ASSIGN</a></div><div class="ttdeci">@ ASSIGN</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00046">goto_program.h:46</a></div></div>
</div><!-- fragment --><p>Otherwise, we check that the LHS is found in the write set's <code>contract_assigns</code> set or the <code>allocated</code> set as shown below:</p>
<div class="fragment"><div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a> check_assign: bool;</div>
<div class="line">CALL check_assign =</div>
<div class="line">  __CPROVER_contracts_write_set_check_assignment(</div>
<div class="line">    write_set, &amp;lhs, <span class="keyword">sizeof</span>(lhs));</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a> check_assign;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a> check_assign;</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba52a9b031766fa116251f70e65a84c01a">ASSIGN</a> lhs := rhs;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md41"></a>
RHS Instrumentation</h3>
<p>For the write set updates we consider the following cases.</p>
<p>If the RHS of the assignment is a <code><a class="el" href="classside__effect__exprt.html" title="An expression containing a side effect.">side_effect_exprt</a>(statement = ID_allocate)</code> expression, it represents a dynamic allocation. We record it in the write set:</p>
<div class="fragment"><div class="line">CALL lhs := <a class="code" href="classside__effect__exprt.html">side_effect_exprt</a>(statement = ID_allocate, args = {size, clear});</div>
<div class="line">----</div>
<div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line">CALL __CPROVER_contracts_write_set_add_allocated(write_set, lhs);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="ttc" id="aclassside__effect__exprt_html"><div class="ttname"><a href="classside__effect__exprt.html">side_effect_exprt</a></div><div class="ttdoc">An expression containing a side effect.</div><div class="ttdef"><b>Definition:</b> <a href="std__code_8h_source.html#l01449">std_code.h:1450</a></div></div>
</div><!-- fragment --><p>If the assignment is an nondeterministic update to the <code>__CPROVER_dead_object</code>, it in fact models a dynamic deallocation. Such instructions are generated to deallocate objects allocated with the dynamic stack allocation function <code>__builtin_alloca</code> and are always legal. We just record the deallocation.</p>
<div class="fragment"><div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba52a9b031766fa116251f70e65a84c01a">ASSIGN</a> __CPROVER_dead_object := <a class="code" href="classif__exprt.html">if_exprt</a>(nondet, ptr, <a class="code" href="pointer__predicates_8cpp.html#aa7ca966850696433c45b4cb96de2f681">dead_object</a>);</div>
<div class="line">----</div>
<div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line">CALL __CPROVER_contracts_write_set_record_deallocated(write_set, ptr);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="ttc" id="aclassif__exprt_html"><div class="ttname"><a href="classif__exprt.html">if_exprt</a></div><div class="ttdoc">The trinary if-then-else operator.</div><div class="ttdef"><b>Definition:</b> <a href="std__expr_8h_source.html#l02322">std_expr.h:2323</a></div></div>
<div class="ttc" id="apointer__predicates_8cpp_html_aa7ca966850696433c45b4cb96de2f681"><div class="ttname"><a href="pointer__predicates_8cpp.html#aa7ca966850696433c45b4cb96de2f681">dead_object</a></div><div class="ttdeci">exprt dead_object(const exprt &amp;pointer, const namespacet &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="pointer__predicates_8cpp_source.html#l00051">pointer_predicates.cpp:51</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
Instrumenting CALL Instructions</h2>
<p>If the function call is a call to the <code>__CPROVER_deallocate</code> function, it represents a dynamic deallocation and we check that the deallocated pointer is allowed by the write set, and then record the deallocation in the write set.</p>
<div class="fragment"><div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a> check_deallocate: bool;</div>
<div class="line">CALL check_deallocate :=</div>
<div class="line"> __CPROVER_contracts_write_set_check_deallocate(write_set, ptr);</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a>(check_deallocate);</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a> check_deallocate;</div>
<div class="line">CALL __CPROVER_contracts_write_set_record_deallocated(write_set, lhs);</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line">CALL <a class="code" href="ansi-c_2library_2cprover_8h.html#a5ef264d7c09f165e1d72b108c150dd32">__CPROVER_deallocate</a>(ptr);</div>
<div class="ttc" id="aansi-c_2library_2cprover_8h_html_a5ef264d7c09f165e1d72b108c150dd32"><div class="ttname"><a href="ansi-c_2library_2cprover_8h.html#a5ef264d7c09f165e1d72b108c150dd32">__CPROVER_deallocate</a></div><div class="ttdeci">void __CPROVER_deallocate(void *)</div></div>
</div><!-- fragment --><p>Calls to <code>__CPROVER_was_freed</code> or <code>__CPROVER_is_freeable</code> are rewritten as described in <a class="el" href="contracts-dev-spec-is-freeable.html">Rewriting Calls to __CPROVER_is_freeable and __CPROVER_was_freed Predicates</a></p>
<p>Calls to <code>__CPROVER_is_fresh</code> are rewritten as described in <a class="el" href="contracts-dev-spec-is-fresh.html">Rewriting Calls to the __CPROVER_is_fresh Predicate</a></p>
<p>Calls to <code>__CPROVER_obeys_contract</code> are rewritten as described in <a class="el" href="contracts-dev-spec-obeys-contract.html">Rewriting Calls to the __CPROVER_obeys_contract Predicate</a></p>
<p>Calls to <code>__CPROVER_pointer_in_range_dfcc</code> are rewritten as described in <a class="el" href="contracts-dev-spec-pointer-in-range.html">Rewriting Calls to the __CPROVER_pointer_in_range_dfcc Predicate</a></p>
<p>For all other function or function pointer calls, we proceed as follows.</p>
<p>If the function call has an LHS (i.e. its result is assigned to a return value variable), the LHS gets checked like for an assignment, and we pass the write set as an extra parameter to the function (remember that all functions of the goto models are extended with write_set parameters by the transformation).</p>
<div class="fragment"><div class="line"><span class="comment">// If the LHS exists</span></div>
<div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a> check_assign: bool;</div>
<div class="line">CALL check_assign =</div>
<div class="line">__CPROVER_contracts_write_set_check_assignment(write_set, &amp;lhs, <span class="keyword">sizeof</span>(lhs));</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a>(check_assign);</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a> check_assign;</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line">CALL [lhs] := <span class="keyword">function</span>(parameters, write_set);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Instrumenting OTHER Instructions</h2>
<p><code>OTHER</code> instructions describe special built-in operations that have no explicit C or GOTO representation (they are given a semantics directly by the symex engine). From <code><a class="el" href="classgoto__symext.html#ac409086f94078675b4f8ee9049afcd67" title="Symbolically execute an OTHER instruction.">goto_symext::symex_other</a></code> we see the possible operations are:</p>
<ul>
<li><code>ID_expression</code></li>
<li><code>ID_array_equal</code></li>
<li><code>ID_array_set</code></li>
<li><code>ID_array_copy</code></li>
<li><code>ID_array_replace</code></li>
<li><code>ID_havoc_object</code></li>
<li><code>ID_decl</code></li>
<li><code>ID_cpp_delete</code></li>
<li><code>ID_printf</code></li>
<li><code><a class="el" href="classcode__inputt.html" title="A goto_instruction_codet representing the declaration that an input of a particular description has a...">code_inputt</a></code></li>
<li><code><a class="el" href="classcode__outputt.html" title="A goto_instruction_codet representing the declaration that an output of a particular description has ...">code_outputt</a></code></li>
<li><code>ID_nondet</code></li>
<li><code>ID_asm</code></li>
<li><code>ID_user_specified_predicate</code></li>
<li><code>ID_user_specified_parameter_predicates</code></li>
<li><code>ID_user_specified_return_predicates</code></li>
<li><code>ID_fence</code></li>
</ul>
<p>Remark: the instructions <code><a class="el" href="classcode__inputt.html" title="A goto_instruction_codet representing the declaration that an input of a particular description has a...">code_inputt</a></code>, <code><a class="el" href="classcode__outputt.html" title="A goto_instruction_codet representing the declaration that an output of a particular description has ...">code_outputt</a></code> and <code>ID_nondet</code> would also need to be instrumented as they perform side effects and introduce non-determinism, but this is not handled as of today and will trigger warnings.</p>
<p>For DFCC we only instrument the <code>array_set</code>, <code>array_copy</code>, <code>array_replace</code> and <code>havoc_object</code> operations.</p>
<p>The example below is for <code>__CPROVER_array_set</code>, and the <code>dest</code> pointer must be found in the <code>contract_assigns</code> set or the <code>allocated</code> set.</p>
<div class="fragment"><div class="line">IF !write_set <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadf1256e4198172eedfbf12c770d11589">GOTO</a> skip_target;</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebac511d45de1f5895f447fbfd7a0741cd8">DECL</a> check_array_set: bool;</div>
<div class="line">CALL check_array_set = </div>
<div class="line"> __CPROVER_contracts_write_set_check_array_set(write_set, dest);</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba61d9e0e93eb9635173764c5ba45666f1">ASSERT</a>(check_array_set);</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba11fd9ca455f92c69c084484d5cd803c2">DEAD</a> check_array_set;</div>
<div class="line">skip_target: <a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296beba998eded080e73768c0b44bf4891df984">SKIP</a>;</div>
<div class="line">----</div>
<div class="line"><a class="code" href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadbf1dee1b8cd7ea3c82661943c7b74f4">OTHER</a> {statement = array_set, args = {dest, value}};</div>
<div class="ttc" id="agoto__program_8h_html_a9e03d66cd12c59d9d3daad1ec6296bebadbf1dee1b8cd7ea3c82661943c7b74f4"><div class="ttname"><a href="goto__program_8h.html#a9e03d66cd12c59d9d3daad1ec6296bebadbf1dee1b8cd7ea3c82661943c7b74f4">OTHER</a></div><div class="ttdeci">@ OTHER</div><div class="ttdef"><b>Definition:</b> <a href="goto__program_8h_source.html#l00037">goto_program.h:37</a></div></div>
</div><!-- fragment --><p>The ranges of bytes <code>(void *lb, size_t size)</code> updated by the different operations are:</p>
<ul>
<li>for <code>array_set(dest, value)</code>:<ul>
<li><code>lb = dest;</code></li>
<li><code>size = object_size(dest) - pointer_offset(ptr);</code></li>
</ul>
</li>
<li>for <code>array_copy(dest, src)</code><ul>
<li><code>lb = dest;</code></li>
<li><code>size = object_size(dest) - pointer_offset(dest);</code></li>
</ul>
</li>
<li>for <code>array_replace(dest, src)</code><ul>
<li><code>lb = dest;</code></li>
<li><code>size = MIN(object_size(dest) - pointer_offset(dest), object_size(src) - pointer_offset(src));</code></li>
</ul>
</li>
<li>for <code>havoc_object(ptr)</code><ul>
<li><code>lb = (char *)ptr - pointer_offset(ptr);</code></li>
<li><code>size = object_size(ptr);</code></li>
</ul>
</li>
</ul>
<hr  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Prev   </th><th class="markdownTableHeadLeft">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="contracts-dev-spec-dfcc.html">Dynamic Frame Condition Checking</a>   </td><td class="markdownTableBodyLeft"><a class="el" href="contracts-dev-spec-harness.html">Proof Harness Intrumentation</a>   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="contracts-mainpage.html">Code Contracts in CBMC</a></li><li class="navelem"><a class="el" href="contracts-dev.html">Code Contracts Developer Documentation</a></li><li class="navelem"><a class="el" href="contracts-dev-spec.html">Code Contracts Transformation Specification</a></li><li class="navelem"><a class="el" href="contracts-dev-spec-dfcc.html">Dynamic Frame Condition Checking</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
