<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: /home/runner/work/cbmc/cbmc/jbmc/src/java_bytecode/java_bytecode_concurrency_instrumentation.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('java__bytecode__concurrency__instrumentation_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">java_bytecode_concurrency_instrumentation.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="java__bytecode__concurrency__instrumentation_8h__dep__incl.svg" width="472" height="200"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="java__bytecode__concurrency__instrumentation_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af4f60986928f20f19446d87dd97f2e64"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="java__bytecode__concurrency__instrumentation_8h.html#af4f60986928f20f19446d87dd97f2e64">convert_threadblock</a> (<a class="el" href="classsymbol__table__baset.html">symbol_table_baset</a> &amp;symbol_table)</td></tr>
<tr class="memdesc:af4f60986928f20f19446d87dd97f2e64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate through the symbol table to find and appropriately instrument thread-blocks.  <a href="java__bytecode__concurrency__instrumentation_8h.html#af4f60986928f20f19446d87dd97f2e64">More...</a><br /></td></tr>
<tr class="separator:af4f60986928f20f19446d87dd97f2e64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a940cd8b840ca00dd8c11d5bf0819a317"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="java__bytecode__concurrency__instrumentation_8h.html#a940cd8b840ca00dd8c11d5bf0819a317">convert_synchronized_methods</a> (<a class="el" href="classsymbol__table__baset.html">symbol_table_baset</a> &amp;symbol_table, <a class="el" href="classmessage__handlert.html">message_handlert</a> &amp;message_handler)</td></tr>
<tr class="memdesc:a940cd8b840ca00dd8c11d5bf0819a317"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate through the symbol table to find and instrument synchronized methods.  <a href="java__bytecode__concurrency__instrumentation_8h.html#a940cd8b840ca00dd8c11d5bf0819a317">More...</a><br /></td></tr>
<tr class="separator:a940cd8b840ca00dd8c11d5bf0819a317"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a940cd8b840ca00dd8c11d5bf0819a317"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a940cd8b840ca00dd8c11d5bf0819a317">&#9670;&nbsp;</a></span>convert_synchronized_methods()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convert_synchronized_methods </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsymbol__table__baset.html">symbol_table_baset</a> &amp;&#160;</td>
          <td class="paramname"><em>symbol_table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmessage__handlert.html">message_handlert</a> &amp;&#160;</td>
          <td class="paramname"><em>message_handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterate through the symbol table to find and instrument synchronized methods. </p>
<p>Synchronized methods make it impossible for two invocations of the same method on the same object to interleave. In-order to replicate these semantics a call to "java::java.lang.Object.monitorenter:(Ljava/lang/Object;)V" and "java::java.lang.Object.monitorexit:(Ljava/lang/Object;)V" is instrumented at the start and end of the method. Note, that the former is instrumented at every statement where the execution can exit the method in question. Specifically, out of order return statements and exceptions. The latter is dealt with by instrumenting a try catch block.</p>
<p>Note: Static synchronized methods are not supported yet as the synchronization semantics for static methods is different (locking on the class instead the of the object). Upon encountering a static synchronized method the current implementation will ignore the synchronized flag. (showing a warning in the process). This may result in superfluous interleavings.</p>
<p>Note': This method requires the availability of "java::java.lang.Object.monitorenter:(Ljava/lang/Object;)V" and "java::java.lang.Object.monitorexit:(Ljava/lang/Object;)V". (java-library-models). If they are not available <a class="el" href="classcode__skipt.html" title="A codet representing a skip statement.">code_skipt</a> will inserted instead of calls to the aforementioned methods.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">symbol_table</td><td>a symbol table </td></tr>
    <tr><td class="paramname">message_handler</td><td>status output </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="java__bytecode__concurrency__instrumentation_8cpp_source.html#l00603">603</a> of file <a class="el" href="java__bytecode__concurrency__instrumentation_8cpp_source.html">java_bytecode_concurrency_instrumentation.cpp</a>.</p>

</div>
</div>
<a id="af4f60986928f20f19446d87dd97f2e64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4f60986928f20f19446d87dd97f2e64">&#9670;&nbsp;</a></span>convert_threadblock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convert_threadblock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsymbol__table__baset.html">symbol_table_baset</a> &amp;&#160;</td>
          <td class="paramname"><em>symbol_table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterate through the symbol table to find and appropriately instrument thread-blocks. </p>
<p>A thread block is a sequence of codet's surrounded with calls to CProver.startThread:(I)V and CProver.endThread:(I)V. A thread block corresponds to the body of the thread to be created. The only parameter accepted by these functions is an integer used to differentiate between different thread blocks. Function startThread() is transformed into a codet ID_start_thread, which carries a target label in the field 'destination'. Similarly endThread() is transformed into a codet ID_end_thread, which marks the end of the thread body. Both codet's will later be transformed (in <a class="el" href="classgoto__convertt.html">goto_convertt</a>) into the goto instructions START_THREAD and END_THREAD.</p>
<p>Additionally the variable __CPROVER__thread_id (thread local) will store the ID of the new thread. The new id is obtained by incrementing a global variable __CPROVER__next_thread_id.</p>
<p>The ID of the thread is made accessible to the Java program by having calls to the function 'CProver.getCurrentThreadId()I' replaced by the variable __CPROVER__thread_id. We also perform this substitution in here. The substitution that we perform here assumes that calls to getCurrentThreadId() are ONLY made in the RHS of an expression.</p>
<p>Example:</p>
<div class="fragment"><div class="line">CProver.startThread(333)</div>
<div class="line">... <span class="comment">// thread body</span></div>
<div class="line">CProver.endThread(333)</div>
</div><!-- fragment --><p>Is transformed into:</p>
<div class="fragment"><div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_start_thread, destination=__CPROVER_THREAD_ENTRY_333)</div>
<div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_goto, destination=__CPROVER_THREAD_EXIT_333)</div>
<div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_label, label=__CPROVER_THREAD_ENTRY_333)</div>
<div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_atomic_begin)</div>
<div class="line">__CPROVER__next_thread_id += 1;</div>
<div class="line">__CPROVER__thread_id = __CPROVER__next_thread_id;</div>
<div class="line">... <span class="comment">// thread body</span></div>
<div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_end_thread)</div>
<div class="line"><a class="code" href="classcodet.html">codet</a>(<span class="keywordtype">id</span>=ID_label, label=__CPROVER_THREAD_EXIT_333)</div>
<div class="ttc" id="aclasscodet_html"><div class="ttname"><a href="classcodet.html">codet</a></div><div class="ttdoc">Data structure for representing an arbitrary statement in a program.</div><div class="ttdef"><b>Definition:</b> <a href="std__code__base_8h_source.html#l00028">std_code_base.h:29</a></div></div>
</div><!-- fragment --><p>Observe that the semantics of ID_start_thread roughly corresponds to: fork the current thread, continue the execution of the current thread in the next line, and continue the execution of the new thread at the destination field of the codet (__CPROVER_THREAD_ENTRY_333).</p>
<p>Note: the current version assumes that a call to startThread(n), where n is an immediate integer, is in the same scope (nesting block) as a call to endThread(n). Some assertion will fail during symex if this is not the case.</p>
<p>Note': the ID of the thread is assigned after the thread is created, this creates bogus interleavings. Currently, it's not possible to assign the thread ID before the creation of the thread, due to a bug in symex. See <a href="https://github.com/diffblue/cbmc/issues/1630/for">https://github.com/diffblue/cbmc/issues/1630/for</a> more details.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">symbol_table</td><td>a symbol table </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="java__bytecode__concurrency__instrumentation_8cpp_source.html#l00485">485</a> of file <a class="el" href="java__bytecode__concurrency__instrumentation_8cpp_source.html">java_bytecode_concurrency_instrumentation.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a263634046f766d6a2cc27bb1bac298e.html">jbmc</a></li><li class="navelem"><a class="el" href="dir_7d9c2272cea08e738f9482db6f677351.html">src</a></li><li class="navelem"><a class="el" href="dir_1a9aed0dd48ec371a7d28ba0a5a70e7e.html">java_bytecode</a></li><li class="navelem"><a class="el" href="java__bytecode__concurrency__instrumentation_8h.html">java_bytecode_concurrency_instrumentation.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
