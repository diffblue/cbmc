<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: goto-symex</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__goto-symex.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">goto-symex</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md136"></a>
Folder goto-symex</h1>
<dl class="section author"><dt>Author</dt><dd>Kareem Khazem, Martin Brain</dd></dl>
<p>This directory contains a symbolic evaluation system for goto-programs. This takes a goto-program and translates it to an equation system by traversing the program, branching and merging and unwinding loops and recursion as needed.</p>
<p>The output of symbolic execution is a system of equations, asserations and assumptions; an object of type <code><a class="el" href="classsymex__target__equationt.html" title="Inheriting the interface of symex_targett this class represents the SSA form of the input program as ...">symex_target_equationt</a></code>, containing a list of <code>symex_target_equationt::SSA_stept</code>, each of which are equalities between <code>exprt</code> expressions. This list is constructed incrementally as the symbolic execution engine walks through the goto-program using the <code><a class="el" href="classsymex__targett.html" title="The interface of the target container for symbolic execution to record its symbolic steps into.">symex_targett</a></code> interface. This interface (implemented by <code><a class="el" href="classsymex__target__equationt.html" title="Inheriting the interface of symex_targett this class represents the SSA form of the input program as ...">symex_target_equationt</a></code>) exposes functions that append SSA steps into the aforementioned list while transforming expressions into Static Single Assignment (SSA) form. For more details on this process see <code><a class="el" href="symex__target__equation_8h.html" title="Generate Equation using Symbolic Execution.">symex_target_equation.h</a></code>, for an overview of SSA see <a class="el" href="group__goto-symex.html#static-single-assignment">Static Single Assignment (SSA) Form</a>.</p>
<p>At a later stage, BMC will convert the generated SSA steps into an equation that can be passed to the solver.</p>
<hr  />
<h1><a class="anchor" id="symbolic-execution"></a>
Symbolic Execution</h1>
<p>In the <a class="el" href="group__goto-symex.html">goto-symex</a> directory.</p>
<p><b>Key classes:</b></p><ul>
<li><a class="el" href="classgoto__symex__statet.html" title="Central data structure: state.">goto_symex_statet</a></li>
<li><a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a></li>
</ul>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_19.svg" width="940" height="59"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<h2><a class="anchor" id="symex-overview"></a>
Overview</h2>
<p>The <a class="el" href="classgoto__symext.html">goto_symext</a> class gets a reference to a <a class="el" href="classsymex__target__equationt.html">equation</a> (initially, an empty list of <a class="el" href="class_s_s_a__stept.html">single-static assignment steps</a>) and a goto-program from the frontend. <a class="el" href="classmulti__path__symex__checkert.html">multi_path_symex_checkert</a> then calls <a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a> to symbolically execute the goto-program, thereby filling the equation, which can then be passed along to the SAT solver.</p>
<p>The class <a class="el" href="classgoto__symext.html">goto_symext</a> holds the global state of the symbol executor, while <a class="el" href="classgoto__symex__statet.html">goto_symex_statet</a> holds the program state at a particular point in symbolic execution. In straight-line code a single <a class="el" href="classgoto__symex__statet.html">goto_symex_statet</a> is maintained, being transformed by each instruction in turn, but these state objects are cloned and merged at control-flow forks and joins respectively. <a class="el" href="classgoto__symex__statet.html">goto_symex_statet</a> contains an instance of <a class="el" href="classvalue__sett.html">value_sett</a>, used to track what objects pointers may refer to, and a constant propagator domain used to try to simplify assignments and (more usefully) resolve branch instructions.</p>
<p>This is a memory-heavy data structure, so <a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a> creates it on-demand and lets it go out-of-scope as soon as possible.</p>
<p>The process of symbolic execution generates an additional <a class="el" href="classsymbol__tablet.html">symbol table</a> of dynamically-created objects; this symbol table is needed when solving the equation. This symbol table must thus be exported out of the state before it is torn down; this is done through the parameter "`new_symbol_table`" passed as a reference to the various functions in <a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a>.</p>
<p>The main symbolic execution loop code is <a class="el" href="classgoto__symext.html#a3144bea45b064925b59804af19b0c39a">goto_symext::symex_step</a>. This function case-switches over the type of the instruction that we're currently executing, and calls various other functions appropriate to the instruction type, i.e. <a class="el" href="classgoto__symext.html#af0d7efca4168117c665fb82182d52ee5" title="Symbolically execute a FUNCTION_CALL instruction.">goto_symext::symex_function_call()</a> if the current instruction is a function call, <a class="el" href="classgoto__symext.html#a4018afc6d7d73369dd9c0c202724458e" title="Symbolically execute a GOTO instruction.">goto_symext::symex_goto()</a> if the current instruction is a goto, etc.</p>
<h2><a class="anchor" id="symex-loop-and-recursion-unwinding"></a>
Loop and recursion unwinding</h2>
<p>Each backwards goto and recursive call has a separate counter (handled by <a class="el" href="group__cbmc.html">cbmc</a> or another driver program, see the <code>--unwind</code> and <code>--unwind-set</code> options). The symbolic execution includes constant folding so loops that have a constant / bounded number of iterations will often be handled completely (assuming the unwinding limit is sufficient). When an unwind or recursion limit is reached, an assertion can be added to explicitly show when analysis is incomplete.</p>
<h2><a class="anchor" id="goto-symext-clean-expr"></a>
goto_symext::clean_expr</h2>
<p>Before any expression is incorporated into the output equation set it is passed through <a class="el" href="classgoto__symext.html#a6c349b47e1fcfdb74a22bf46c4479ff4">goto_symext::clean_expr</a> and thus <a class="el" href="classgoto__symext.html#ad6751f48d9d16d92b161f74fb7691ec0">goto_symext::dereference</a>, whose primary purpose is to remove dereference operations. It achieves this using the <a class="el" href="classvalue__sett.html">value_sett</a> stored in <a class="el" href="classgoto__symex__statet.html">goto_symex_statet</a>, replacing <code>*x</code> with a construct such as <code>x == &amp;candidate1 ? candidate1 : x == &amp;candidate2 ? candidate2 : x$object</code></p>
<p>Note the <code>x$object</code> fallback candidate, which is known as a <em>failed symbol</em> or <em>failed object</em>, and represents the unknown object pointed to by <code>x</code> when neither of the candidates (<code>candidate1</code> and <code>candidate2</code> here) matched as expected. This is of course unsound, since <code>x$object</code> and <code>y$object</code> are always distinct, even if <code>x</code> and <code>y</code> might actually alias, but at least it ensures writes to and subsequent reads from <code>x</code> are related.</p>
<p><a class="el" href="classgoto__symext.html#ad6751f48d9d16d92b161f74fb7691ec0">goto_symext::dereference</a> function also passes its argument to <a class="el" href="classgoto__symex__statet.html#a934d3a7b0f55daa4a41ff697bdd96913">goto_symex_statet::rename</a>, which is responsible for both SSA renaming symbols and for applying constant propagation where possible. Renaming is also performed elsewhere without calling <a class="el" href="classgoto__symext.html#ad6751f48d9d16d92b161f74fb7691ec0">goto_symext::dereference</a> when an expression is already known to be pointer-free.</p>
<h2><a class="anchor" id="symex-path"></a>
Path exploration</h2>
<p>By default, CBMC symbolically executes the entire program, building up an equation representing all instructions, which it then passes to the solver. Notably, it <em>merges</em> paths that diverge due to a goto instruction, forming a constraint that represents having taken either of the two paths; the code for doing this is <a class="el" href="classgoto__symext.html#a9a742ff98f05db5a3352828b64368c77">goto_symext::merge_goto</a>.</p>
<p>Goto-symex can operate in a different mode when the <code>--paths</code> flag is passed in the <a class="el" href="classoptionst.html">optionst</a> object passed to its constructor (<a class="el" href="group__cbmc.html">cbmc</a> passes this from the corresponding command-line option). This disables path merging; instead, symex executes a single path at a time, returning each one to its caller, which in the case of cbmc then calls its solver with the equation representing that path, then continues to execute other paths. The 'other paths' that would have been taken when the program branches are saved onto a workqueue so that the driver program can continue to execute the current path, and then later retrieve saved paths from the workqueue. Implementation-wise, <a class="el" href="classsingle__path__symex__checkert.html">single_path_symex_checkert</a> maintains a worklist and passes it to <a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a>. If path exploration is enabled, <a class="el" href="classgoto__symext.html" title="The main class for the forward symbolic simulator.">goto_symext</a> will fill up the worklist whenever it encounters a branch, instead of merging the paths on the branch. The worklist is initialized with the initial state at the entry point. Then <a class="el" href="classsingle__path__symex__checkert.html">single_path_symex_checkert</a> continues popping the worklist and executing untaken paths until the worklist empties. Note that this means that the default model-checking behaviour is a special case of path exploration: when model-checking, the initial symbolic execution run does not add any paths to the workqueue but rather merges all the paths together, so the additional path-exploration loop is skipped over.</p>
<hr  />
<h1><a class="anchor" id="static-single-assignment"></a>
Static Single Assignment (SSA) Form</h1>
<p><b>Key classes:</b></p><ul>
<li><a class="el" href="classsymex__targett.html">symex_targett</a></li>
<li><a class="el" href="classsymex__target__equationt.html">symex_target_equationt</a></li>
</ul>
<p><em>Static Single Assignment (SSA)</em> form is an intermediate representation that satisfies the following properties:</p>
<ol type="1">
<li>Every variable is <em>assigned exactly once</em>.</li>
<li>Every variable must be <em>defined</em> before use.</li>
</ol>
<p>In-order to convert a goto-program to SSA form all variables are indexed (renamed) through the addition of a <em>suffix</em>.</p>
<p>There are three “levels” of indexing:</p>
<p><b>Level 2 (L2):</b> variables are indexed every time they are encountered in a function.</p>
<p><b>Level 1 (L1):</b> variables are indexed every time the functions that contain those variables are called.</p>
<p><b>Level 0 (L0):</b> variables are indexed every time a new thread containing those variables are spawned.</p>
<p>We can inspect the indexed variable names with the <b>&ndash;show-vcc</b> or <b>&ndash;program-only</b> flags. Variables in SSA form are printed in the following format: <code>%s!%d@%d#%d</code>. Where the string field is the variable name, and the numbers after the !, @, and # are the L0, L1, and L2 suffixes respectively.</p>
<blockquote class="doxtable">
<p>Note: <b>&ndash;program-only</b> prints all the SSA steps in-order. In contrast, <b>&ndash;show-vcc</b> will for each assertion print the SSA steps (assumes, assignments and constraints only) that synthetically precede the assertion. In the presence of multiple threads it will also print SSA steps that succeed the assertion. </p>
</blockquote>
<h2><a class="anchor" id="L1-L2"></a>
Level 1 and level 2 indexing</h2>
<p>The following examples illustrate Level 1 and 2 indexing. </p><pre class="fragment">$ cat l1.c
int main()
{
  int x=7;
  x=8;
  assert(0);
}

$ cbmc --show-vcc l1.c
...
{-12} x!0@1#2 == 7
{-13} x!0@1#3 == 8
</pre><p> That is, the L0 names for both x's are 0; the L1 names for both x's are 1; but each occurrence of x within <a class="el" href="file__converter_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a> gets a fresh L2 suffix (2 and 3, respectively). </p><pre class="fragment">$ cat l2.c
void foo()
{
  int x=7;
  x=8;
  x=9;
}
int main()
{
  foo();
  foo();
  assert(0);
}

$ cbmc --show-vcc l2.c
...
{-12} x!0@1#2 == 7
{-13} x!0@1#3 == 8
{-14} x!0@1#4 == 9
{-15} x!0@2#2 == 7
{-16} x!0@2#3 == 8
{-17} x!0@2#4 == 9
</pre><p> That is, every time we enter function foo, the L1 counter of x is incremented (from 1 to 2) and the L2 counter is reset (back to 2, after having been incremented up to 4). The L2 counter then increases every time we access x as we walk through the function.</p>
<h2><a class="anchor" id="L0"></a>
Level 0 indexing (threads only)</h2>
<p>TODO: describe and give a concrete example</p>
<h2><a class="anchor" id="PL"></a>
Relevant Primary Literature</h2>
<p>Thread indexing is based on the following paper:</p>
<blockquote class="doxtable">
<p>Lee, J., Midkiff, S.P. and Padua, D.A., 1997, August. Concurrent static single assignment form and constant propagation for explicitly parallel programs. In International Workshop on Languages and Compilers for Parallel Computing (pp. 114-130). Springer, Berlin, Heidelberg. </p>
</blockquote>
<p>Seminal paper on SSA:</p>
<blockquote class="doxtable">
<p>Rosen, B.K., Wegman, M.N. and Zadeck, F.K., 1988, January. Global value numbers and redundant computations. In Proceedings of the 15th ACM SIGPLAN-SIGACT symposium on Principles of programming languages (pp. 12-27). ACM. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md139"></a>
&lt;/blockquote&gt;</h2>
<h1><a class="anchor" id="counter-example-production"></a>
Counter Example Production</h1>
<p>In the <a class="el" href="group__goto-symex.html">goto-symex</a> directory.</p>
<p><b>Key classes:</b></p><ul>
<li><a class="el" href="classsymex__target__equationt.html">symex_target_equationt</a></li>
<li><a class="el" href="classprop__convt.html">prop_convt</a></li>
<li><a class="el" href="classcounterexample__beautificationt.html">counterexample_beautificationt</a></li>
</ul>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_20.svg" width="680" height="59"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<h1><a class="anchor" id="Concurrency"></a>
Concurrency</h1>
<h2><a class="anchor" id="Partial"></a>
Order Concurrency</h2>
<p>The class <a class="el" href="classpartial__order__concurrencyt.html">partial_order_concurrencyt</a> provides an interface for implementing ordering of concurrent events. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
