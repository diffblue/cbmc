<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: Loop Invariant Clauses</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('contracts-loop-invariants.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Loop Invariant Clauses </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md103">Syntax</a></li>
<li class="level1"><a href="#autotoc_md104">Semantics</a></li>
<li class="level1"><a href="#autotoc_md105">Additional Resources</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_cbmc_cbmc_src_goto_instrument_contracts_doc_user_contracts_loop_invariants"></a> Back to <a class="el" href="contracts-user.html">Code Contracts User Documentation</a></p>
<p>An <em>invariant</em> clause specifies a property that must be preserved by every iteration of a loop. In general a loop has infinitely many invariants. For instance, <code>true</code> is a trivial invariant that holds before the loop, and after each iteration of the loop (thus, inductive). However, <code>true</code> is rarely useful &ndash; it is an extremely imprecise abstraction of a loop, which is generally not <em>sufficient</em> to prove any subsequent assertions.</p>
<h1><a class="anchor" id="autotoc_md103"></a>
Syntax</h1>
<p>An <em>invariant</em> clause accepts a valid Boolean expression over the variables visible at the same scope as the loop. Additionally, [history variables] are also allowed within invariant clauses.</p>
<div class="fragment"><div class="line">__CPROVER_loop_invariant(<span class="keywordtype">bool</span> cond)</div>
</div><!-- fragment --><p>Invariant clauses may be specified just after the loop guard. Multiple invariant clauses on the same loop are allowed, and is equivalent to a single invariant clause that is a conjunction of those clauses. A few examples are shown below.</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span>(i &lt; n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i &amp;&amp; i &lt;= n)</div>
<div class="line">{ ... }</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; n; ++i)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i)</div>
<div class="line">__CPROVER_loop_invariant(i &lt;= n)</div>
<div class="line">{ ... }</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">do</span> { ... }</div>
<div class="line"><span class="keywordflow">while</span> (i &lt; n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i)</div>
<div class="line">__CPROVER_loop_invariant(i &lt;= n);</div>
</div><!-- fragment --><p><b>Important.</b> Invariant clauses must be free of <em>side effects</em>, for example, mutation of local or global variables. Otherwise, CBMC raises an error message during compilation: </p><div class="fragment"><div class="line">Loop invariant is not side-effect free. (at: file main.c line 4 function main) </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md104"></a>
Semantics</h1>
<p>A loop invariant clause expands to several assumptions and assertions:</p><ol type="1">
<li>The invariant is <em>asserted</em> just before the first iteration.</li>
<li>The invariant is <em>assumed</em> on a non-deterministic state to model a non-deterministic iteration.</li>
<li>The invariant is finally <em>asserted</em> again to establish its inductiveness.</li>
</ol>
<p>Mathematical induction is the working principle here. (1) establishes the base case for induction, and (2) &amp; (3) establish the inductive case. Therefore, the invariant must hold <em>after</em> the loop execution for <em>any</em> number of iterations. The invariant, together with the negation of the loop guard, must be sufficient to establish subsequent assertions. If it is not, the abstraction is too imprecise and the user must supply a stronger invariant.</p>
<p>To illustrate the key idea, consider the following [binary search] loop with invariant clauses:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> binary_search(<span class="keywordtype">int</span> val, <span class="keywordtype">int</span> *buf, <span class="keywordtype">int</span> size)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(size &lt;= 0 || buf == NULL) <span class="keywordflow">return</span> NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">long</span> lb = 0, ub = size - 1;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">long</span> mid = ((<span class="keywordtype">unsigned</span> int)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(lb &lt;= ub)</div>
<div class="line">  __CPROVER_loop_invariant(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size)</div>
<div class="line">  __CPROVER_loop_invariant(mid == ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1)</div>
<div class="line">  {</div>
<div class="line">     <span class="keywordflow">if</span>(buf[mid] == val) <span class="keywordflow">break</span>;</div>
<div class="line">     <span class="keywordflow">if</span>(buf[mid] &lt; val)</div>
<div class="line">       lb = mid + 1;</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">       ub = mid - 1;</div>
<div class="line">     mid = ((<span class="keywordtype">unsigned</span> int)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The instrumented GOTO program is conceptually similar to the following high-level C program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> binary_search(<span class="keywordtype">int</span> val, <span class="keywordtype">int</span> *buf, <span class="keywordtype">int</span> size)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(size &lt;= 0 || buf == NULL) <span class="keywordflow">return</span> NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">long</span> lb = 0, ub = size - 1;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">long</span> mid = ((<span class="keywordtype">unsigned</span> int)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* 1. assert invariant at loop entry */</span></div>
<div class="line">  assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  assert(mid == ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* 2. create a non-deterministic state for modified variables */</span></div>
<div class="line">  havoc(lb, ub, mid);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* 3. establish invariant to model state at an arbitrary iteration */</span></div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a>(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a>(mid == ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* 4. perform a single arbitrary iteration (or exit the loop) */</span></div>
<div class="line">  <span class="keywordflow">if</span>(lb &lt;= ub)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(buf[mid] == val) <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">if</span>(buf[mid] &lt; val)</div>
<div class="line">      lb = mid + 1;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      ub = mid - 1;</div>
<div class="line">    mid = ((<span class="keywordtype">unsigned</span> int)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 5. assert the invariant to establish inductiveness */</span></div>
<div class="line">    assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">    assert(mid == ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)lb + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 6. terminate this symbolic execution path; similar to &quot;exit&quot; */</span></div>
<div class="line">    <a class="code" href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a>(<span class="keyword">false</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
<div class="ttc" id="acprover__builtin__headers_8h_html_ae5af07e274b573cd0f23ffb9d332bef2"><div class="ttname"><a href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a></div><div class="ttdeci">void __CPROVER_assume(__CPROVER_bool assumption)</div></div>
</div><!-- fragment --><p>A few things to note here:</p>
<ul>
<li>At instrumented code point (2), when we <code>havoc</code> the modified variables, this set of modified variables is automatically computed using alias analysis of l-values appearing in the loop body. However, the analysis is incomplete and may fail to characterize the set for complex loops. In such cases, the user must manually annotate the set of modified variables using an <a class="el" href="contracts-assigns.html">_assigns clause_</a>.</li>
<li>At instrumented code point (6), when we <em>assume</em> <code>false</code>, observe that this assumption only exists within the <code>lb &lt;= ub</code> conditional. Therefore, only the symbolic execution path <em>inside</em> this conditional block terminates. The code outside of the conditional block continues to be symbolically executed, and subsequent assertions do not become vacuously <code>true</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md105"></a>
Additional Resources</h1>
<ul>
<li><a class="el" href="contracts-functions.html">Function Contracts</a><ul>
<li><a class="el" href="contracts-requires-ensures.html">Requires and Ensures Clauses</a></li>
<li><a class="el" href="contracts-assigns.html">Assigns Clauses</a></li>
<li><a class="el" href="contracts-frees.html">Frees Clauses</a></li>
</ul>
</li>
<li><a class="el" href="contracts-loops.html">Loop Contracts</a><ul>
<li><a class="el" href="contracts-loop-invariants.html">Loop Invariant Clauses</a></li>
<li><a class="el" href="contracts-decreases.html">Decreases Clauses</a></li>
<li><a class="el" href="contracts-assigns.html">Assigns Clauses</a></li>
<li><a class="el" href="contracts-frees.html">Frees Clauses</a></li>
</ul>
</li>
<li><a class="el" href="contracts-memory-predicates.html">Memory Predicates</a></li>
<li><a class="el" href="contracts-function-pointer-predicates.html">Function Pointer Predicates</a></li>
<li><a class="el" href="contracts-history-variables.html">History Variables</a></li>
<li><a class="el" href="contracts-quantifiers.html">Quantifiers</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="contracts-mainpage.html">Code Contracts in CBMC</a></li><li class="navelem"><a class="el" href="contracts-user.html">Code Contracts User Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
