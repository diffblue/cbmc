<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: goto-instrument</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__goto-instrument.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">goto-instrument</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md28"></a>
Folder goto-instrument</h1>
<dl class="section author"><dt>Author</dt><dd>Martin Brain</dd></dl>
<p>The <code>goto-instrument/</code> directory contains a number of tools, one per file, that are built into the <code>goto-instrument</code> program. All of them take in a goto-program (produced by <code>goto-cc</code>) and either modify it or perform some analysis. Examples include <code><a class="el" href="nondet__static_8cpp.html">nondet_static.cpp</a></code> which initialises static variables to a non-deterministic value, <code><a class="el" href="nondet__volatile_8cpp.html">nondet_volatile.cpp</a></code> which assigns a non-deterministic value to any volatile variable before it is read and <code><a class="el" href="weak__memory_8h.html">weak_memory.h</a></code> which performs the necessary transformations to reason about weak memory models. The exception to the “one file for each piece of functionality” rule are the program instrumentation options (mostly those given as “Safety checks” in the <code>goto-instrument</code> help text) which are included in the <code>goto-program/</code> directory. An example of this is <code>goto-program/stack_depth.h</code> and the general rule seems to be that transformations and instrumentation that <code>cbmc</code> uses should be in <code>goto-program/</code>, others should be in <code>goto-instrument</code>.</p>
<p><code>goto-instrument</code> is a very good template for new analysis tools. New developers are advised to copy the directory, remove all files apart from <code>main.*</code>, <code>parseoptions.*</code> and the <code>Makefile</code> and use these as the skeleton of their application. The <code>doit()</code> method in <code>parseoptions.cpp</code> is the preferred location for the top level control for the program.</p>
<h3><a class="anchor" id="autotoc_md29"></a>
Main usage</h3>
<p>For most of the transformations, <code>goto-instrument</code> takes one or two arguments and any number of options. The two file arguments are a goto-binary that it uses as an input for the transformation, and then <em>another goto binary</em> that it uses to write the result of the transformation. This is important because many times, if you don't supply a second filename for the goto-binary to be written to, you get the equivalent of the <code>--help</code> option output, with no indication of what has gone wrong. Some of the options can work with just an input file and not output file. For more specific examples, take a look at the demonstrations below:</p>
<h3><a class="anchor" id="autotoc_md30"></a>
Function pointer removal</h3>
<p>As an example of a transformation pass being run, imagine you have a file called <code>function_pointers.c</code> with the following content: </p><pre class="fragment">    int f1(void);
    int f2(void);
    int f3(void);
    int f4(void);

    int (* const fptbl1[][2])(void) = {
      { f1, f2 },
      { f3, f4 },
    };

    int g1(void);
    int g2(void);

    int (* const fptbl2[])(void) = {
      g1, g2
    };

    int func(int id1, int id2)
    {
      int t;
      t = fptbl1[id1][id2]();
      t = fptbl2[id1]();
      return t;
    }
</pre><p>Then, assuming you have compiled it to a goto-binary with <code>goto-cc</code>, called <code>function_pointers.goto</code>, you could see the output of the <code>--show-goto-functions</code> flag on the unmodified program: </p><pre class="fragment">    Reading GOTO program from `function_pointers.goto'
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    func /* func */
            // 0 file function_pointer.c line 20 function func
            signed int t;
            // 1 file function_pointer.c line 21 function func
            t=fptbl1[(signed long int)id1][(signed long int)id2]();
            // 2 file function_pointer.c line 22 function func
            t=fptbl2[(signed long int)id1]();
            // 3 file function_pointer.c line 23 function func
            return t;
            // 4 file function_pointer.c line 23 function func
            dead t;
            // 5 file function_pointer.c line 23 function func
            GOTO 1
            // 6 file function_pointer.c line 24 function func
         1: END_FUNCTION
</pre><p>Then, you can run a transformation pass with <code>goto-instrument --remove-function-pointers function_pointers.goto function_pointers_modified.goto</code>, and then ask to show the result of the transformation through showing the goto-functions again: </p><pre class="fragment">    Reading GOTO program from `function_pointers_modified.goto'
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    func /* func */
            // 0 file function_pointer.c line 20 function func
            signed int t;
            // 1 file function_pointer.c line 21 function func
            fptbl1[(signed long int)id1][(signed long int)id2];
            // 2 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == f3 THEN GOTO 1
            // 3 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == f2 THEN GOTO 2
            // 4 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == f1 THEN GOTO 3
            // 5 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == f4 THEN GOTO 4
            // 6 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == g1 THEN GOTO 5
            // 7 file function_pointer.c line 21 function func
            IF fptbl1[(signed long int)id1][(signed long int)id2] == g2 THEN GOTO 6
            // 8 file function_pointer.c line 21 function func
         1: t=f3();
            // 9 file function_pointer.c line 21 function func
            GOTO 7
            // 10 file function_pointer.c line 21 function func
         2: t=f2();
            // 11 file function_pointer.c line 21 function func
            GOTO 7
            // 12 file function_pointer.c line 21 function func
         3: t=f1();
            // 13 file function_pointer.c line 21 function func
            GOTO 7
            // 14 file function_pointer.c line 21 function func
         4: t=f4();
            // 15 file function_pointer.c line 21 function func
            GOTO 7
            // 16 file function_pointer.c line 21 function func
         5: t=g1();
            // 17 file function_pointer.c line 21 function func
            GOTO 7
            // 18 file function_pointer.c line 21 function func
         6: t=g2();
            // 19 file function_pointer.c line 22 function func
         7: fptbl2[(signed long int)id1];
            // 20 file function_pointer.c line 22 function func
            IF fptbl2[(signed long int)id1] == g1 THEN GOTO 8
            // 21 file function_pointer.c line 22 function func
            IF fptbl2[(signed long int)id1] == g2 THEN GOTO 9
            // 22 file function_pointer.c line 22 function func
         8: t=g1();
            // 23 file function_pointer.c line 22 function func
            GOTO 10
            // 24 file function_pointer.c line 22 function func
         9: t=g2();
            // 25 file function_pointer.c line 23 function func
        10: return t;
            // 26 file function_pointer.c line 23 function func
            dead t;
            // 27 file function_pointer.c line 24 function func
            END_FUNCTION
</pre><p>You can now see that the function pointer (indirect) call (resulting from the array indexing of the array containing the function pointers) has now been substituted by direct, conditional calls.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
Call Graph</h3>
<p>This is an example of a command line flag that requires only one argument, specifying the input file.</p>
<p>You can see the call graph of a particular goto-binary by issuing <code>goto-instrument --call-graph &lt;goto_binary&gt;</code>. This gives a result similar to this: </p><pre class="fragment">    Reading GOTO program from `a.out'
    Function Pointer Removal
    Virtual function removal
    Cleaning inline assembler statements
    main -&gt; fun
    __CPROVER__start -&gt; __CPROVER_initialize
    __CPROVER__start -&gt; main
    fun -&gt; malloc
</pre><p>The interesting part of the output in the above text is the last four lines, that show that <code>main</code> is calling <code>fun</code>, <code>__CPROVER__start</code> is calling <code>__CPROVER_initialize</code> and <code>main</code> and that <code>fun</code> is calling <code>malloc</code>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
