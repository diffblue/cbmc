<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: Compilation and Development</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('compilation-and-development.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Compilation and Development </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Martin Brain, Peter Schrammel, Owen Jones</dd></dl>
<h1><a class="anchor" id="compilation-and-development-section-compilation"></a>
Compilation</h1>
<p>The CBMC source code is available on <a href="https://github.com/diffblue/cbmc">its GitHub page</a>.</p>
<h2><a class="anchor" id="compilation-and-development-subsection-makefiles"></a>
Makefiles</h2>
<p>Instructions for compiling CBMC using makefiles are available in <a href="https://github.com/diffblue/cbmc/blob/develop/COMPILING.md#what-architecture">COMPILING.md</a> in the root of the CBMC repository. They cover Linux, Solaris 11, FreeBSD 11, MacOS X and Windows.</p>
<h2><a class="anchor" id="compilation-and-development-subsection-cmake-files"></a>
CMake files</h2>
<p>There is also support for compiling using CMake. Instructions are available in <a href="https://github.com/diffblue/cbmc/blob/develop/COMPILING.md#working-with-cmake">COMPILING.md</a> in the root of the CBMC repository.</p>
<h2><a class="anchor" id="compilation-and-development-subsection-personal-configuration"></a>
Personal configuration</h2>
<h3><a class="anchor" id="compilation-and-development-subsubsection-config-inc"></a>
config.inc</h3>
<p>Two files, <a href="https://github.com/diffblue/cbmc/blob/develop/src/config.inc">config.inc</a> and <a href="https://github.com/diffblue/cbmc/blob/develop/src/common">common</a>, are included in every makefile. <a href="https://github.com/diffblue/cbmc/blob/develop/src/config.inc">config.inc</a> contains configuration options relating to compilation so that they can be conveniently edited in one place. <a href="https://github.com/diffblue/cbmc/blob/develop/src/common">common</a> contains commands that are needed in every makefile but which the developer is not expected to edit. (There is also <a href="https://github.com/diffblue/cbmc/blob/develop/jbmc/src/config.inc">another config.inc</a> which is also included in every makefile in the <code>jbmc</code> folder.)</p>
<p>Note, these files are not involved in the CMake build.</p>
<h3><a class="anchor" id="compilation-and-development-subsubsection-macro-debug"></a>
Macro DEBUG</h3>
<p>If the macro <code>DEBUG</code> is defined during compilation of CBMC (for example by using a compiler flag) then extra debug code will be included. This includes print statements and code checking that data structures are as expected.</p>
<h1><a class="anchor" id="compilation-and-development-section-running-tests"></a>
Running tests</h1>
<h2><a class="anchor" id="compilation-and-development-subsection-regression-tests"></a>
Regression tests</h2>
<p>The regression tests are contained in <code>regression/</code> and <code>jbmc/regression/</code>. Inside these folders there is a directory for each of the modules. Each of these contains multiple test directories, with names describing what they test. When there are multiple tests in a test directory then they should all test very similar aspects of the program's behaviour. Each test directory contains input files and one or more test description files, which have the ending <code>.desc</code>. The test description files specify what command to run, what output is expected and so on. The test framework is a Perl script, <a href="https://github.com/diffblue/cbmc/blob/develop/regression/test.pl">test.pl</a>, located in <code>regression/test.pl</code>.</p>
<p>The <code>--help</code> option to <code>test.pl</code> outlines the format of the test description files. Most importantly, the first word in a test description file is its level, which is one of: <code>CORE</code> (should be run in CI, should succeed), <code>THOROUGH</code> (takes too long to be run in CI, should succeed), <code>FUTURE</code> (will succeed when a planned feature is added) or <code>KNOWNBUG</code> (will succeed when a bug is fixed).</p>
<p>Test descriptions may also include a number of tags. <code>test.pl -I&lt;tag&gt;</code> will only run tests with a particular <code>&lt;tag&gt;</code>, and <code>test.pl -X&lt;tag&gt;</code> will run all tests except for those with a particular <code>&lt;tag&gt;</code>. See <a href="https://github.com/diffblue/cbmc/blob/develop/regression/README.md">regression/README.md</a> for the current set of tags and their intended use.</p>
<h3><a class="anchor" id="compilation-and-development-subsubsection-running-regression-tests-with-make"></a>
Running regression tests with make</h3>
<p>If you have compiled using <code>make</code> then you can run the regression tests using <code>make test</code>. Run it from <code>regression/</code> to run all the regression tests, or any of its subfolders to just run the tests for that module. The number of tests that are run in parallel can be controlled through the environment variable <code>TESTPL_JOBS</code>.</p>
<p>If you have not compiled using <code>make</code> then this won't work, because the makefile is expecting to find binaries like <code>cbmc</code> and <code>jbmc</code> in the source folders.</p>
<h3><a class="anchor" id="compilation-and-development-subsubsection-running-regression-tests-with-ctest"></a>
Running regression tests with CTest</h3>
<p>If you have compiled using CMake then you can run the regression tests using CTest. (Note: this will also run the unit tests.)</p>
<p>Here are two example commands, to be run from the <code>build/</code> directory: </p><pre class="fragment">ctest -V -L CORE -R cpp
ctest -V -L CORE -R cpp -E cbmc-cpp
</pre><p> <code>-V</code> makes it print out more useful output. <code>-L CORE</code> makes it only run tests that have been tagged <code>CORE</code>. <code>-R regular_expression</code> can be used to limit which tests are run to those which match the given regular expression, and <code>-E regex</code> excludes tests to those which match the given regular expression. So the first command will run all the CORE tests in <code>regression/cbmc/cpp</code> and <code>regression/cbmc/cbmc-cpp</code>, and the second will run all the CORE tests in <code>regression/cbmc/cpp</code> only. Another useful option is <code>-N</code>, which makes CTest list which tests it will run without actually running them.</p>
<h3><a class="anchor" id="compilation-and-development-subsubsection-running-individual-regression-tests-directly-with-test-pl"></a>
Running individual regression tests directly with test.pl</h3>
<p>It can be useful to run a single test folder in isolation. This can be done by running <code>regression/test.pl</code> directly. The way that <code>test.pl</code> is run varies between the different modules, and can be ascertained by looking at the <code>test</code> target in the makefile. The simple case is when there isn't a file called <code>chain.sh</code>. Then you can directly run <code>test.pl</code> on a single test folder with the following command from the module directory (note that it is recommended to use absolute paths as it avoids many issues, e.g. the path to the binary should be relative to <code>&lt;test-folder&gt;</code>): </p><pre class="fragment">&lt;absolute-path-to-test.pl&gt; -p -c &lt;absolute-path-to-binary&gt; &lt;test-folder&gt;
</pre><p> <code>-p</code> makes it print a log of failed tests and <code>-c</code> tells it where to find the binary to run, e.g. <code>cbmc</code>, <code>jbmc</code> or <code>goto-analyzer</code>. If <code>&lt;test-folder&gt;</code> is not provided then all test directories are run. The <code>--help</code> option lists all command line options, including <code>-j</code> for running multiple tests in parallel and <code>-C</code>, <code>-T</code>, <code>-F</code> and <code>-K</code> for controlling whether <code>CORE</code>, <code>THOROUGH</code>, <code>FUTURE</code> or <code>KNOWNBUG</code> tests are run.</p>
<p>When there is a file called <code>chain.sh</code> then the command should look like </p><pre class="fragment">&lt;absolute-path-to-test.pl&gt; -p -c '&lt;absolute-path-to-chain-sh&gt; &lt;arg-1&gt; ... &lt;arg-n&gt;' &lt;test-folder&gt;
</pre><p> Note that the test binary and its initial command line arguments are a single value for the -c option, so they must be be wrapped in quotes if they contain any unescaped spaces. What to put for the arguments <code>&lt;arg-1&gt;</code> to <code>&lt;arg-n&gt;</code> varies from module to module. To find out, look in <code>chain.sh</code> and see what arguments it expects. You can also look in the <code>Makefile</code> and see how it calls <code>chain.sh</code> in the <code>test</code> target.</p>
<h2><a class="anchor" id="compilation-and-development-subsection-unit-tests"></a>
Unit tests</h2>
<p>The unit tests are contained in the <code>unit/</code> folder. They are written using the <a href="https://github.com/philsquared/Catch">Catch</a> unit test framework.</p>
<p>If you have compiled with <code>make</code>, you can run the unit tests for CBMC directly by going to <code>unit/</code>, running <code>make</code> to compile the unit tests and then <code>make test</code> to run them. You can run the unit tests for JBMC directly by going to <code>jbmc/unit/</code> and running the same commands.</p>
<p>If you have compiled with CMake, you can run the unit tests for CBMC directly by going to <code>unit/</code> and running </p><pre class="fragment">../&lt;build-folder&gt;/bin/unit
</pre><p> and you can run the unit tests for JBMC directly by going to <code>jbmc/unit/</code> and running </p><pre class="fragment">../../&lt;build-folder&gt;/bin/java-unit
</pre><p> If you have compiled with CMake you can also run the unit tests through CTest, with the names <code>unit</code> and <code>java-unit</code>. So, from the <code>build/</code> directory, run </p><pre class="fragment">ctest -V -L CORE -R ^unit
ctest -V -L CORE -R java-unit
</pre><p> to run the CBMC unit tests and the JBMC unit tests respectively. (The <code>^</code> is needed to make it a regular expression that matches <code>unit</code> but not <code>java-unit</code>.)</p>
<p>Note that some tests run which are expected to fail - see the summary at the end of the run to see how many tests passed, how many failed which were expected to and how many tests failed which were not expected to.</p>
<p>For more information on the structure of <code>unit/</code> and how to tag tests, see <a href="https://github.com/diffblue/cbmc/blob/develop/CODING_STANDARD.md#unit-tests">the section on unit tests in <code>CODING_STANDARD.md</code> in the root of the CBMC repository</a></p>
<h2><a class="anchor" id="compilation-and-development-subsection-coverage"></a>
Test coverage</h2>
<p>On Unix-style systems you can automatically generate a code coverage report. To obtain an HTML report for the test and unit tests, first build the dedicated coverage configuration using CMake (setting <code>enable_coverage</code> and building the <code>coverage</code> target): </p><pre class="fragment">cmake -S . -Bcov-build -Denable_coverage=1 -Dparallel_tests=2
make -C cov-build coverage
</pre><p> This configures a build environment in the <code>cov-build/</code> folder with coverage recording at runtime enabled. The actual build (using <code>make</code> in the above case) will run the test suite, running <code>parallel_tests</code>-many tests concurrently (in the above case: 2). The HTML report is generated using <code>lcov</code> and stored in <code>cov-build/html/</code>.</p>
<h2><a class="anchor" id="compilation-and-development-subsection-sat-solver"></a>
Using a different SAT solver</h2>
<p>By default, CBMC will assume MiniSat 2 as the SAT back-end. Several other solvers are supported (see also [config.inc](compilation-and-development-subsubsection-config-inc) above). As a more general option, which is not limited to a single SAT solver, you may use the IPASIR interface. For example, to use the SAT solver RISS, proceed as follows:</p>
<p>1) Build RISS (in particular its IPASIR configuration): </p><pre class="fragment">git clone https://github.com/conp-solutions/riss riss.git
cd riss.git
mkdir build
cd build
cmake ..
make riss-coprocessor-lib-static
cd ../..
</pre><p> 2) Build CBMC while enabling the IPASIR back-end: make -C src IPASIR=../../riss.git/riss \ LIBS="../../riss.git/build/lib/libriss-coprocessor.a -lpthread"</p>
<p>3) Run CBMC - note that RISS is highly configurable via the RISSCONFIG environment variable: export RISSCONFIG=VERBOSE:BMC1 ... run CBMC ...</p>
<h1><a class="anchor" id="compilation-and-development-section-documentation"></a>
Documentation</h1>
<p>Apart from the (user-orientated) CBMC user manual and this document, most of the rest of the documentation is inline in the code as <code>doxygen</code> and some comments. A man page for CBMC, goto-cc and goto-instrument is contained in the <code>doc/</code> directory and gives some options for these tools. All of these could be improved and patches are very welcome. In some cases the algorithms used are described in the relevant papers.</p>
<p>The doxygen documentation can be <a href="https://diffblue.github.io/cbmc/">accessed online</a>. To build it locally, run <code>scripts/run_doxygen.sh</code>. HTML output will be created in <code>doc/html/</code>. The index page is <code>doc/html/index.html</code>. This script will filter out expected warning messages from doxygen, so that new problems are more obvious. It is important to use the correct version of doxygen, as specified in <code>run_doxygen.sh</code>, so that there are no unexpected changes to the list of expected warnings. In the event that any change fixes an old warning, then the corresponding line(s) should be deleted from <code>scripts/expected_doxygen_warnings.txt</code>. We want to avoid adding any more warnings to this list of expected warnings, but that can be done to work around limitations in Doxygen (where the code and documentation are completely correct).</p>
<h1><a class="anchor" id="compilation-and-development-section-formatting"></a>
Formatting</h1>
<p>The <a href="https://github.com/diffblue/cbmc/blob/develop/CODING_STANDARD.md"><code>CODING_STANDARD.md</code></a> file in the root of the CBMC repository contains guidance on how to write code for the CBMC repository. This includes which language features can be used and formatting rules.</p>
<p>C++ code can be automatically reformatted in the correct way by running <code>clang-format</code>. There are more details in <a href="https://github.com/diffblue/cbmc/blob/develop/CODING_STANDARD.md#using-clang-format">CODING_STANDARD.md</a>.</p>
<h1><a class="anchor" id="compilation-and-development-section-linting"></a>
Linting</h1>
<p>There is also a linting script, <code>scripts/cpplint.py</code>. There is a wrapper script to run <code>cpplint.py</code> only on lines that differ from another branch, e.g. to run it on lines that have been changed from <code>develop</code>: </p><pre class="fragment">scripts/run_lint.sh develop
</pre><p> There are also instructions for adding this as a git pre-commit hook in <a href="https://github.com/diffblue/cbmc/blob/develop/CODING_STANDARD.md#pre-commit-hook-to-run-cpplint-locally">CODING_STANDARD.md</a>.</p>
<h1><a class="anchor" id="compilation-and-development-section-time-profiling"></a>
Time profiling</h1>
<p>To do time profiling with a tool like <code>gprof</code>, the flags <code>-g</code> (build with debug symbols) and <code>-pg</code> (enable profiling information) must be used when compiling, and <code>-pg</code> must be used when linking. If you are building with cmake you can just add "-Denable_profiling=1" to your cmake invocation, and reload cmake before building your desired binary. Note that these flags require everything to be rebuilt, so it will take a long time even if you are using ccache.</p>
<p>Run your binary as normal. A file called gmon.out will be created in the working directory of the binary at the end of execution. In most instances this will be the same as the working directory at the beginning of execution. It is also possible to choose the output location by setting the environment variable GMON_OUT_PREFIX - the output file location is then whatever you set it to with the process id appended to the end.</p>
<p>Make sure gprof is installed by running <code>gprof -v</code>. If it is not installed then run <code>sudo apt install binutils</code>.</p>
<p>Run <code>gprof &lt;path-to-binary&gt; &lt;path-to-gmon.out&gt;</code> and redirect the output to a file. This will take a while to run - e.g. 12 minutes for test-gen run on a trivial function.</p>
<p>The output file will now be a large text file. There are two sections: the "flat
profile", which ignores context, and just tells you how much time was spent in each function; and the "call graph", which includes context, and tells you how much time was spent within each call stack. For more information see online tutorials, like <a href="https://ftp.gnu.org/old-gnu/Manuals/gprof-2.9.1/html_chapter/gprof_5.html">https://ftp.gnu.org/old-gnu/Manuals/gprof-2.9.1/html_chapter/gprof_5.html</a></p>
<p>Last modified: 2024-06-12 16:14:48 +0200 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Documentation</a></li><li class="navelem"><a class="el" href="cprover_documentation.html">CProver documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
