<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Architecture Decision Records: Release Process</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Architecture Decision Records
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Architecture Decision Records</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Release Process </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Date</b>: 2020-10-08 <b>Updated</b>: 2023-03-29 <b>Author</b>: Fotis Koutoulakis, <a href="#" onclick="location.href='mai'+'lto:'+'fot'+'is'+'.ko'+'ut'+'oul'+'ak'+'is@'+'di'+'ffb'+'lu'+'e.c'+'om'; return false;">fotis<span style="display: none;">.nosp@m.</span>.kou<span style="display: none;">.nosp@m.</span>toula<span style="display: none;">.nosp@m.</span>kis@<span style="display: none;">.nosp@m.</span>diffb<span style="display: none;">.nosp@m.</span>lue.<span style="display: none;">.nosp@m.</span>com</a> <b>Domain</b>: Release &amp; Packaging</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Process</h2>
<p>The current process we follow through to make a new release is the following:</p>
<ol type="1">
<li><p class="startli">At the point in time we want to make the release, we make a change to two files: <code>src/config.inc</code>, wherein we update the configuration variable <code>CBMC_VERSION</code>, and <code>src/libcprover-rust/Cargo.toml</code>, wherein we update the <code>version</code> variable to be the same as <code>CBMC_VERSION</code> (e.g. set both to <code>5.80.0</code>).</p>
<p class="startli">This is important as it informs the various tools of the current version of CBMC.</p>
<p class="startli">(This needs to be pushed as a PR, and after it gets merged we move on to:)</p>
</li>
<li>Then we make a <code>git tag</code> out of that commit, and push it to github. The tag needs to be of the form <code>cbmc-&lt;version&gt;</code> with version being a version number of the form of <code>x.y.z</code>, with <code>x</code> denoting the major version, <code>y</code> denoting the minor version, and <code>z</code> identifying the patch version (useful for a hotfix or patch.)</li>
<li><p class="startli">Pushing the Rust crate, which is documented <a href="https://doc.rust-lang.org/cargo/commands/cargo-publish.html">here</a> but effectively entails logging in with an API token generated from <a href="https://crates.io">https://crates.io</a> with <code>cargo login</code>, and then issuing <code>cargo publish</code>.</p>
<p class="startli">The usual environment variables are required (part of the <code>publish</code> step is that the crate can be built) - these are documented in the <code>readme.md</code> file at the root of the <code>src/libcprover-rust/</code> directory, and online at <a href="https://crates.io/crates/libcprover_rust">libcprover_rust</a>.</p>
<p class="startli">For the crate to be pushed successfully, the user performing the <code>cargo publish</code> step needs to be a member of the <a href="https://github.com/orgs/diffblue/teams/diffblue-opensource">diffblue/diffblue-opensource</a> team.</p>
</li>
</ol>
<p>At this point, the rest of the process is automated, so we don't need to do anything more, but the process is described below for reference:</p>
<ol type="1">
<li><code>.github/workflows/regular-release.yaml</code> gets triggered on the <code>push</code> of the tag, and creates a Github release of the version that was described in the tag pushed (so, tag <code>cbmc-5.15.20</code> is going to create the release titled <code>cbmc-5.15.20</code> on the release page).</li>
<li><p class="startli"><code>.github/workflows/release-packages.yaml</code> gets triggered automatically at the creation of the release, and its job is to build packages for Windows, Ubuntu 18.04 and Ubuntu 20.04 (for now, we may support more specific Ubuntu versions later) and attaches them (after it has finished building them) to the release page as release artifacts.</p>
<p class="startli">It also makes a PR to the homebrew repository that updates the version of CBMC in homebrew. That's then approved and merged by the maintainers of homebrew.</p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md11"></a>
Versioning</h2>
<p>We adopt an approach approximating SemVer. That is, our version numbers should be major.minor.patch. Regular releases (as of 2022-06-23: every other week) should normally increment the minor version number. This is also where we can deprecate undesired features, i.e., mark as deprecated, warn existing users.</p>
<p>Patch version increments should not be done as part of the regular releases, and instead should be reserved for critical bugfixes and issues noticed in the process of doing a regular release. Don't make a patch release if you're not confident your release contains nothing but bugfixes.</p>
<p>Major version increments should be reserved for changes which we expect will break downstream users scripts and/or workflows. This includes things like changing the goto binary format in such a way that old outputs can't be read by new version of our tools or vice versa, or removing deprecated functionality (removal of functionality should generally be preceded by deprecation!). Note that incrementing the major version every time a change technically could break a downstream users scripts would lead to a weak signal, as basically any detectable change including bugfixes can do that. Instead, major version increments should signal that we expect many users will have to review their workflows for potential breakages, not just any.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Rust API versioning</h3>
<p>Following discussions during the development of <code>libcprover_rust</code>, it was decided that it would be easiest if the Rust API version was following the same scheme that CBMC does, so that it's clear which version of the Rust API corresponds to which version of CBMC.</p>
<p>This means that the Rust API has two "versions" it can report.</p>
<ol type="1">
<li>The library version, as reported in <code>Cargo.toml</code>, and</li>
<li>The (C++) API version, which is coming from CBMC and aligns with the version number in <code>config.inc</code> (reported via the <code>get_api_version()</code> API call).</li>
</ol>
<p>Most of the time, these two numbers will be the same - but there can be scenarios where they can diverge: if the user for example uses a later version of the Rust API (say, <code>5.80.0</code>) to link against a static library representing an older version of CBMC (say <code>5.79.0</code>).</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Constraints</h2>
<p>Initial design of the release process suggested that the release cadence of CBMC was going to be one regular release (incrementing the <code>y</code> part of the version) every two weeks, on Thursday.</p>
<p>Originally we wanted to automate this part, but we were limited by the fact that we needed to update <code>src/config.inc</code> before doing the release, and that couldn't be done in an automated fashion, as any update needs to go through a PR, and gets stuck on code-owners approvals, making the whole process more manual than intended.</p>
<p>Following this original limitation, we decided to settle on doing manual releases every two weeks, but having the process being initiated by a developer manually making the change to <code>src/config.inc</code>, and after that has been merged, mark that specific commit as with a version tag, and push that version tag to Github. At that point, the rest of the process is automated.</p>
<p>The change to the current implementation was part of <a href="https://github.com/diffblue/cbmc/pull/5517">https://github.com/diffblue/cbmc/pull/5517</a>.</p>
<p>Last modified: 2024-04-25 12:32:00 -0700 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
