<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Architecture Decision Records: libcprover-cpp and Modularisation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Architecture Decision Records
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Architecture Decision Records</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libcprover-cpp and Modularisation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Date</b>: 22 Jun 2023 <b>Updated</b>: 22 Jun 2023 <b>Author</b>: Fotis Koutoulakis, <a href="#" onclick="location.href='mai'+'lto:'+'fot'+'is'+'.ko'+'ut'+'oul'+'ak'+'is@'+'di'+'ffb'+'lu'+'e.c'+'om'; return false;">fotis<span style="display: none;">.nosp@m.</span>.kou<span style="display: none;">.nosp@m.</span>toula<span style="display: none;">.nosp@m.</span>kis@<span style="display: none;">.nosp@m.</span>diffb<span style="display: none;">.nosp@m.</span>lue.<span style="display: none;">.nosp@m.</span>com</a> <b>Domain</b>: Architecture, API <b>Description</b>: This document outlines our thinking about the rearchitecting of CBMC using the C++ API (<code>libcprover-cpp</code>) as the central module and the transitioning of other tools to use that as a basis.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Motivation &amp;&amp; Current State of Affairs</h2>
<p>CProver is a collection of tools fitting various program analysis needs. CProver has been the product of the evolution of the codebase of the model-checking tool for C (<code>CBMC</code>). Since then CProver has been adopted with various front-ends/back-ends and auxilliary tools.</p>
<p>During this time, the repository has grown organically, using some guidelines for development that were based on tradition and intuition rather than some agreed architectural approach. This development model has been successful for most of CProver's life, based on its nature as a hybrid industrial/academic and experimental/applied tool. However, this has had the side-effect of accruing some code duplication and technical debt. Consequently, the codebase is complex and difficult to understand and develop for. This is a large barrier to new developers, new features, and also improving and fixing the existing CProver tools.</p>
<p>The above concerns have generated discussions about the breaking down of CProver into modules, with cleaner interfaces and tighter boundary control between them, making the code easier to integrate in other projects (by making the various component modules easier to combine and reuse) and making the codebase easier to understand and maintain.</p>
<p>The desire to separate functionality into different functional units would also remove duplication and bloat, and prevent issues with the same flag behaving in different ways across CProver tools.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
The Plan Going Forward</h2>
<p>Given the above outline, we have reached a point where we are strongly motivated to take action to better componentise and modularise CProver. What we mean by "better componentise and modularise" is that right now, even though there exists some structure between different CBMC components (at the class level or at the code&#160;source file level), the different components aren't cleanly separated in terms of boundaries/concerns, which hinders their reusability or understandability.</p>
<p>It is also an opportune time for us, given the existence of <code>libcprover-cpp</code> the C++ API that we built to support interfacing with Rust (for now - other languages may be coming in the future): we can use this as the basis of development for an API exposing the interfaces of the various other modules and refactor them into the better-defined shape we want them to take on an incremental basis.</p>
<p>Of course, this is a project that is massive in scope, potentially being exposed to further scope creep. We acknowledge that any effort to do what we have discussed already is going to be a multi-year effort from our end, and that we will need community alignment to achieve the outcome we are looking for.</p>
<p>This is why we are looking into testing the approach on a smaller component first, to get a better feel for the amount of effort and any challenges lurking in the dark.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
&lt;tt&gt;goto-bmc&lt;/tt&gt; and &lt;tt&gt;libcprover-cpp&lt;/tt&gt;</h2>
<p>One of the objectives of our modularisation efforts is to decouple the various components <code>CBMC</code> is based on (front-ends, backends, etc) to allow for reuse/recombination. As a first segue into the larger effort, we wanted a tool focusing only on running symex (the backend of our analysis engine) on a GOTO-binary that has been preprocessed into an appropriate form.</p>
<p>We took the first steps for that in <a href="https://github.com/diffblue/cbmc/pull/7762">cbmc#7762</a>.</p>
<p>The aim of the PR was not only to allow for the tool with the narrower-scope to come to life, but also to see if we could expose just enough of the process to the C++ API and use that as the basis of the new tool.</p>
<p>This whole process has been very informative: we found out that not only we <em>can</em> use the C++ API in that capacity, but also that extending the API as and when we need to, and doing the various refactorings to the other tools on a Just-In-Time basis is viable.</p>
<p>There have been, however, some limitations:</p>
<ul>
<li>The C++ API is still nascent, and as such its support for various workflows is just not present (yet). We can (and do) build things fast, as and when we need them - but it is nowhere near feature complete to provide for all of a user's workflows at the time of this writing.</li>
<li>Still on the C++ API, its usage as the implementation basis for the new tool <code>goto-bmc</code> means that the code-structure and patterns in <code>goto-bmc</code> are going to differ from other existing tools in the CProver-suite.</li>
<li><p class="startli">CProver tools have primarily been based on textual output to report on the results of their function (be it analysis, or transformations, etc). This has not been a problem up until this point (with the caveat that occasionally requests for support of new textual formats come up and adding support for those has become a laborious process).</p>
<p class="startli">There is a need however for the separation of concerns between the production of the results by the analysis engine and the presentation layer for those.</p>
</li>
</ul>
<p>We are working towards addressing these teething problems, but while we are still operating on those, we have to accept some compromises in the architecture of the code while we are iterating or stabilising several of the new or refactored parts.</p>
<p>Be advised that some constructs may pop up in some limited locations in the codebase that may appear questionable. We are only asking for some patience while we are working out the best way to refactor them into an architecture that is more cohesive with the long term vision for the platform.</p>
<p>From our end, we will do our best to avoid any spillover effects to other areas of the codebase, and to avoid introducing any behavioural regressions while we are implementing the above plan. Any constructs that may feature "questionable" changes to parts will be marked as such and be followed with an explanation as to why the decision was made.</p>
<p>Last modified: 2024-04-25 12:30:47 -0700 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
